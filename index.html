
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GestorPRO - Sistema Futurista</title>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&display=swap');

        :root {
            --cor-primaria: #00e676;
            --cor-secundaria: #8c9eff;
            --cor-sucesso: #00c853;
            --cor-perigo: #ff5252;
            --cor-aviso: #ffea00;
            --cor-fundo: #1a1a2e;
            --cor-fundo-sidebar: #16213e;
            --cor-texto: #e0e0e0;
            --cor-borda: #0f3460;
            --sombra-caixa: 0 4px 15px rgba(0, 230, 118, 0.2);
            --card-background: #0f3460;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Roboto', sans-serif; }
        body { background-color: var(--cor-fundo); color: var(--cor-texto); overflow-x: hidden; }
        
        /* Container responsivo */
        .container { 
            display: flex; 
            flex-direction: column;
            min-height: 100vh;
        }

        /* Sidebar responsiva */
        .sidebar { 
            background-color: var(--cor-fundo-sidebar); 
            padding: 15px;
            border-bottom: 1px solid var(--cor-borda);
            width: 100%;
            z-index: 1000;
            box-shadow: var(--sombra-caixa);
            position: relative;
        }
        
        .sidebar-header { 
            display: flex; 
            justify-content: space-between; 
            align-items: center;
            margin-bottom: 15px;
        }
        
        .sidebar-header h3 { 
            font-size: 1.5rem; 
            color: var(--cor-primaria); 
            font-family: 'Orbitron', sans-serif; 
            text-shadow: 0 0 10px var(--cor-primaria);
            margin: 0;
        }
        
        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--cor-primaria);
            font-size: 1.5rem;
            cursor: pointer;
        }
        
        .sidebar nav {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            transition: all 0.3s ease;
        }
        
        .sidebar nav button {
            background: none;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
            color: var(--cor-texto);
            white-space: nowrap;
        }
        
        .sidebar nav button:hover {
            background-color: rgba(0, 230, 118, 0.1);
            color: var(--cor-primaria);
        }
        
        .sidebar nav button.active {
            background-color: var(--cor-primaria);
            color: var(--cor-fundo-sidebar);
            font-weight: bold;
            box-shadow: 0 0 15px var(--cor-primaria);
        }
        
        .sidebar nav button .ph { font-size: 1.1rem; }

        /* Main content responsivo */
        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            width: 100%;
        }
        
        .page {
            display: none;
            width: 100%;
            animation: fadeIn 0.5s forwards;
        }
        
        .page.active { display: block; }
        
        @keyframes fadeIn { 
            from { opacity: 0; transform: translateY(10px); } 
            to { opacity: 1; transform: translateY(0); } 
        }

        /* Typography responsiva */
        h1, h2, h3 { 
            color: var(--cor-primaria); 
            font-family: 'Orbitron', sans-serif; 
            text-shadow: 0 0 8px rgba(0, 230, 118, 0.5);
            word-wrap: break-word;
        }
        
        h1 { 
            font-size: 1.8rem; 
            margin-bottom: 20px; 
            display: flex; 
            align-items: center; 
            gap: 10px;
        }
        
        h2 { 
            font-size: 1.5rem; 
            margin-top: 25px; 
            margin-bottom: 15px; 
            border-bottom: 2px solid var(--cor-primaria); 
            padding-bottom: 6px;
        }
        
        h3 { font-size: 1.3rem; margin-bottom: 15px; }

        /* Buttons responsivos */
        .btn-primary, .btn-secondary, .btn-danger, .btn-warning {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 0.95rem;
            cursor: pointer;
            transition: all 0.3s ease;
            color: var(--cor-fundo);
            font-weight: bold;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin: 5px 0;
            width: 100%;
            max-width: 300px;
            justify-content: center;
        }
        
        .btn-primary { background-color: var(--cor-primaria); box-shadow: 0 0 10px var(--cor-primaria); }
        .btn-secondary { background-color: var(--cor-secundaria); box-shadow: 0 0 10px var(--cor-secundaria); }
        .btn-danger { background-color: var(--cor-perigo); box-shadow: 0 0 10px var(--cor-perigo); }
        .btn-warning { background-color: var(--cor-aviso); color: var(--cor-fundo); box-shadow: 0 0 10px var(--cor-aviso); }
        
        .btn-primary:hover { background-color: var(--cor-sucesso); transform: translateY(-2px); box-shadow: 0 5px 15px var(--cor-primaria); }
        .btn-secondary:hover { background-color: #7987ff; transform: translateY(-2px); box-shadow: 0 5px 15px var(--cor-secundaria); }

        /* Grids e Cards responsivos */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 15px;
            width: 100%;
        }
        
        .clickable-card {
            background-color: var(--card-background);
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--sombra-caixa);
            border: 1px solid var(--cor-borda);
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }
        
        .clickable-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 25px rgba(0, 230, 118, 0.3);
            border-color: var(--cor-primaria);
        }
        
        .clickable-card h3 {
            margin-bottom: 10px;
            font-weight: 500;
            color: var(--cor-texto);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1rem;
        }
        
        .clickable-card p {
            font-size: 2rem;
            font-weight: 700;
            color: var(--cor-primaria);
            font-family: 'Orbitron', sans-serif;
            margin: 10px 0;
        }
        
        .card-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: auto;
            font-size: 0.85rem;
            color: var(--cor-texto);
        }
        
        .card-arrow {
            color: var(--cor-primaria);
            font-size: 1rem;
            transition: transform 0.3s;
        }
        
        .clickable-card:hover .card-arrow {
            transform: translateX(5px);
        }

        /* Forms responsivos */
        .form-container, .table-container, .generator-container, .report-container {
            background-color: var(--card-background);
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--sombra-caixa);
            margin-bottom: 20px;
            border: 1px solid var(--cor-borda);
            width: 100%;
            overflow-x: auto;
        }
        
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
        }
        
        input, select, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid var(--cor-borda);
            border-radius: 8px;
            font-size: 0.95rem;
            background-color: #1a1a2e;
            color: var(--cor-texto);
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        
        input:focus, select:focus, textarea:focus {
            border-color: var(--cor-primaria);
            box-shadow: 0 0 8px rgba(0, 230, 118, 0.5);
            outline: none;
        }
        
        textarea {
            grid-column: 1 / -1;
            resize: vertical;
            min-height: 100px;
        }

        /* Tables responsivas */
        .table-wrapper {
            overflow-x: auto;
            width: 100%;
            margin-top: 15px;
        }
        
        table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            min-width: 600px;
        }
        
        th, td {
            padding: 12px 8px;
            text-align: left;
            border-bottom: 1px solid var(--cor-borda);
            color: var(--cor-texto);
            font-size: 0.9rem;
        }
        
        th {
            color: var(--cor-primaria);
            font-weight: bold;
            text-transform: uppercase;
            font-size: 0.85rem;
            white-space: nowrap;
        }
        
        tbody tr:nth-child(even) {
            background-color: rgba(0, 230, 118, 0.03);
        }
        
        tbody tr:hover {
            background-color: rgba(0, 230, 118, 0.1);
        }

        /* Status badges */
        .status {
            padding: 5px 10px;
            border-radius: 20px;
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
            display: inline-block;
            text-align: center;
            min-width: 100px;
        }
        
        .status.planejamento { background-color: var(--cor-aviso); color: var(--cor-fundo); }
        .status.andamento { background-color: var(--cor-primaria); }
        .status.concluido { background-color: var(--cor-sucesso); }
        .status.cancelado { background-color: var(--cor-perigo); }

        /* Modal responsivo */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            animation: modalFadeIn 0.5s forwards;
            padding: 20px;
            overflow-y: auto;
        }
        
        .modal-content {
            background-color: var(--card-background);
            margin: auto;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 0 30px rgba(0, 230, 118, 0.7);
            width: 100%;
            max-width: 800px;
            border: 2px solid var(--cor-primaria);
            position: relative;
            animation: modalScaleIn 0.5s forwards;
        }

        /* Relatórios responsivos */
        .report-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
        }
        
        .report-filters label {
            font-weight: 500;
            color: var(--cor-primaria);
            min-width: 120px;
        }
        
        .report-filters select {
            min-width: 200px;
            max-width: 300px;
        }
        
        .financial-summary {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .card {
            background-color: var(--card-background);
            padding: 20px;
            border-radius: 12px;
            box-shadow: var(--sombra-caixa);
            border: 1px solid var(--cor-borda);
            text-align: center;
        }
        
        .card h3 {
            margin-bottom: 10px;
            font-weight: 500;
            color: var(--cor-texto);
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
            font-size: 1rem;
        }
        
        .card p {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--cor-primaria);
            font-family: 'Orbitron', sans-serif;
            word-break: break-word;
        }
        
        .chart-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }
        
        .chart-wrapper {
            background: var(--card-background);
            padding: 20px;
            border-radius: 12px;
            border: 1px solid var(--cor-borda);
            box-shadow: var(--sombra-caixa);
            width: 100%;
            overflow-x: auto;
        }

        /* Kanban responsivo */
        .kanban-board {
            display: flex;
            flex-direction: column;
            gap: 20px;
            width: 100%;
        }
        
        @media (min-width: 992px) {
            .kanban-board {
                flex-direction: row;
                overflow-x: auto;
            }
        }
        
        .kanban-column {
            flex: 1;
            min-width: 300px;
            background-color: #16213e;
            border-radius: 12px;
            border: 1px solid var(--cor-borda);
            box-shadow: var(--sombra-caixa);
        }

        /* Document preview responsivo */
        #documento-preview {
            background: var(--cor-fundo-sidebar);
            width: 100%;
            min-height: auto;
            padding: 20px;
            margin: 1rem auto;
            box-shadow: var(--sombra-caixa);
            border: 1px solid var(--cor-borda);
            font-family: 'Lato', sans-serif;
            color: var(--cor-texto);
            overflow-x: auto;
        }
        
        @media (min-width: 768px) {
            #documento-preview {
                width: 21cm;
                min-height: 29.7cm;
                padding: 2cm;
            }
        }

        /* Media Queries para diferentes tamanhos de tela */
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                padding: 10px;
            }
            
            .sidebar nav {
                flex-direction: column;
                align-items: stretch;
                max-height: 0;
                overflow: hidden;
                transition: max-height 0.3s ease;
            }
            
            .sidebar nav.active {
                max-height: 500px;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .main-content {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.6rem;
                flex-direction: column;
                align-items: flex-start;
                gap: 5px;
            }
            
            .dashboard-grid {
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
                gap: 12px;
            }
            
            .form-grid {
                grid-template-columns: 1fr;
            }
            
            .modal-content {
                padding: 15px;
                margin: 10px;
            }
            
            .report-filters {
                flex-direction: column;
                align-items: stretch;
            }
            
            .report-filters select {
                min-width: 100%;
            }
            
            .financial-summary {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .dashboard-grid {
                grid-template-columns: 1fr;
            }
            
            .clickable-card p {
                font-size: 1.8rem;
            }
            
            .card p {
                font-size: 1.5rem;
            }
            
            .btn-primary, .btn-secondary, .btn-danger, .btn-warning {
                padding: 8px 15px;
                font-size: 0.9rem;
            }
            
            th, td {
                padding: 8px 5px;
                font-size: 0.85rem;
            }
        }
        
        @media (min-width: 769px) {
            .container {
                flex-direction: row;
                height: 100vh;
            }
            
            .sidebar {
                width: 250px;
                height: 100vh;
                position: fixed;
                left: 0;
                top: 0;
                border-right: 1px solid var(--cor-borda);
                border-bottom: none;
                padding: 20px;
            }
            
            .sidebar-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .mobile-menu-btn {
                display: none;
            }
            
            .sidebar nav {
                flex-direction: column;
                flex-wrap: nowrap;
                align-items: stretch;
                max-height: none !important;
            }
            
            .main-content {
                margin-left: 250px;
                width: calc(100% - 250px);
                padding: 30px;
            }
        }

        /* Print styles */
        @media print {
            .sidebar, .mobile-menu-btn, .document-controls button:not(#btn-print) {
                display: none !important;
            }
            
            .main-content {
                margin-left: 0 !important;
                width: 100% !important;
                padding: 0 !important;
            }
            
            #documento-preview {
                width: 100% !important;
                min-height: auto !important;
                padding: 1cm !important;
                margin: 0 !important;
                box-shadow: none !important;
                border: none !important;
            }
        }
        
        /* Scrollbar personalizada */
        .main-content::-webkit-scrollbar {
            width: 8px;
        }
        
        .main-content::-webkit-scrollbar-track {
            background: transparent;
        }
        
        .main-content::-webkit-scrollbar-thumb {
            background-color: var(--cor-primaria);
            border-radius: 20px;
            border: 2px solid var(--cor-fundo);
        }
        
        /* Animações */
        @keyframes modalFadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes modalScaleIn { from { transform: scale(0.7); opacity: 0; } to { transform: scale(1); opacity: 1; } }
    </style>
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <div class="sidebar-header">
                <h3>GestorPRO</h3>
                <button class="mobile-menu-btn" onclick="toggleSidebar()">
                    <i class="ph ph-list"></i>
                </button>
            </div>
            <nav id="sidebar-nav">
                <button onclick="showPage('dashboard')"><i class="ph ph-house"></i> Painel de Controle</button>
                <button onclick="showPage('relatorios')"><i class="ph ph-chart-line"></i> Relatórios</button>
                <button onclick="showPage('clientes')"><i class="ph ph-users"></i> Clientes</button>
                <button onclick="showPage('projetos')"><i class="ph ph-kanban"></i> Projetos</button>
                <button onclick="showPage('financeiro')"><i class="ph ph-currency-circle-dollar"></i> Financeiro</button>
                <button onclick="showPage('contratos')"><i class="ph ph-file-text"></i> Contratos e Recibos</button>
                <button onclick="showPage('configuracoes')"><i class="ph ph-gear"></i> Configurações</button>
            </nav>
        </aside>

        <main class="main-content">
            <section id="dashboard" class="page active">
                <h1><i class="ph ph-house"></i> Painel de Controle</h1>
                <div class="dashboard-grid">
                    <div class="clickable-card" onclick="navigateTo('clientes')">
                        <h3><i class="ph ph-users"></i> Clientes Ativos</h3>
                        <p id="total-clientes">0</p>
                        <div class="card-info">
                            <span>Ver todos os clientes</span>
                            <span class="card-arrow"><i class="ph ph-arrow-right"></i></span>
                        </div>
                    </div>
                    
                    <div class="clickable-card" onclick="navigateTo('projetos')">
                        <h3><i class="ph ph-kanban"></i> Total de Projetos</h3>
                        <p id="total-projetos-geral">0</p>
                        <div class="card-info">
                            <span>Ver todos os projetos</span>
                            <span class="card-arrow"><i class="ph ph-arrow-right"></i></span>
                        </div>
                    </div>
                    
                    <div class="clickable-card" onclick="navigateTo('projetos', 'planejamento')">
                        <h3><i class="ph ph-clipboard-text"></i> Planejamento</h3>
                        <p id="total-projetos-planejamento">0</p>
                        <div class="card-info">
                            <span>Ver projetos em planejamento</span>
                            <span class="card-arrow"><i class="ph ph-arrow-right"></i></span>
                        </div>
                    </div>
                    
                    <div class="clickable-card" onclick="navigateTo('projetos', 'andamento')">
                        <h3><i class="ph ph-trend-up"></i> Em Andamento</h3>
                        <p id="total-projetos-andamento-dashboard">0</p>
                        <div class="card-info">
                            <span>Ver projetos em andamento</span>
                            <span class="card-arrow"><i class="ph ph-arrow-right"></i></span>
                        </div>
                    </div>
                    
                    <div class="clickable-card" onclick="navigateTo('projetos', 'concluido')">
                        <h3><i class="ph ph-check-circle"></i> Concluídos</h3>
                        <p id="total-projetos-concluido">0</p>
                        <div class="card-info">
                            <span>Ver projetos concluídos</span>
                            <span class="card-arrow"><i class="ph ph-arrow-right"></i></span>
                        </div>
                    </div>
                    
                    <div class="clickable-card" onclick="navigateTo('projetos', 'cancelado')">
                        <h3><i class="ph ph-x-circle"></i> Cancelados</h3>
                        <p id="total-projetos-cancelado">0</p>
                        <div class="card-info">
                            <span>Ver projetos cancelados</span>
                            <span class="card-arrow"><i class="ph ph-arrow-right"></i></span>
                        </div>
                    </div>
                </div>

                <div class="chart-dashboard-container" style="margin-top: 30px;">
                    <h2><i class="ph ph-chart-pie"></i> Status dos Projetos</h2>
                    <div style="height: 300px; width: 100%;">
                        <canvas id="projectStatusChart"></canvas>
                    </div>
                </div>
            </section>

            <section id="relatorios" class="page">
                <h1><i class="ph ph-chart-line"></i> Relatórios Avançados</h1>
                
                <div class="report-container">
                    <h3>Filtros de Relatório</h3>
                    <div class="report-filters">
                        <div>
                            <label for="report-type">Tipo de Relatório:</label>
                            <select id="report-type" onchange="updateReportFilters()">
                                <option value="projetos">Relatório de Projetos</option>
                                <option value="financeiro">Relatório Financeiro</option>
                                <option value="clientes">Relatório de Clientes</option>
                            </select>
                        </div>
                        
                        <div id="project-filters" style="display: block;">
                            <label for="project-status-filter">Status do Projeto:</label>
                            <select id="project-status-filter">
                                <option value="todos">Todos os Status</option>
                                <option value="planejamento">Planejamento</option>
                                <option value="andamento">Em Andamento</option>
                                <option value="concluido">Concluído</option>
                                <option value="cancelado">Cancelado</option>
                            </select>
                            
                            <label for="project-phase-filter" style="margin-left: 15px;">Fase:</label>
                            <select id="project-phase-filter">
                                <option value="todos">Todas as Fases</option>
                                <option value="Análise">Análise</option>
                                <option value="Design (UI/UX)">Design (UI/UX)</option>
                                <option value="Desenvolvimento">Desenvolvimento</option>
                                <option value="Testes">Testes</option>
                                <option value="Implantação">Implantação</option>
                            </select>
                        </div>
                        
                        <div id="financial-filters" style="display: none;">
                            <label for="financial-period">Período:</label>
                            <select id="financial-period">
                                <option value="esteMes">Este Mês</option>
                                <option value="mesPassado">Mês Passado</option>
                                <option value="esteAno">Este Ano</option>
                                <option value="todoPeriodo">Todo o Período</option>
                            </select>
                            
                            <label for="financial-type" style="margin-left: 15px;">Tipo:</label>
                            <select id="financial-type">
                                <option value="ambos">Receitas e Despesas</option>
                                <option value="receita">Apenas Receitas</option>
                                <option value="despesa">Apenas Despesas</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="date-range">Período:</label>
                            <select id="date-range">
                                <option value="todoPeriodo">Todo o Período</option>
                                <option value="esteMes">Este Mês</option>
                                <option value="ultimos3Meses">Últimos 3 Meses</option>
                                <option value="esteAno">Este Ano</option>
                                <option value="customizado">Personalizado</option>
                            </select>
                        </div>
                        
                        <div id="custom-date-range" style="display: none; width: 100%;">
                            <label for="start-date">Data Inicial:</label>
                            <input type="date" id="start-date">
                            
                            <label for="end-date" style="margin-left: 15px;">Data Final:</label>
                            <input type="date" id="end-date">
                        </div>
                    </div>
                    
                    <div style="margin-top: 20px; display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn-primary" onclick="generateReport()">
                            <i class="ph ph-magnifying-glass"></i> Gerar Relatório
                        </button>
                        <button class="btn-secondary" onclick="exportReportToPDF()" id="export-pdf-btn" style="display: none;">
                            <i class="ph ph-file-pdf"></i> Exportar para PDF
                        </button>
                        <button class="btn-warning" onclick="exportReportToCSV()" id="export-csv-btn" style="display: none;">
                            <i class="ph ph-file-csv"></i> Exportar para CSV
                        </button>
                    </div>
                </div>
                
                <div id="report-results" class="report-container" style="display: none;">
                    <h3>Resultados do Relatório</h3>
                    <div class="table-wrapper">
                        <table id="report-table">
                            <thead id="report-table-head">
                                <!-- Cabeçalho será preenchido dinamicamente -->
                            </thead>
                            <tbody id="report-table-body">
                                <!-- Dados serão preenchidos dinamicamente -->
                            </tbody>
                        </table>
                    </div>
                    
                    <div id="report-summary" style="margin-top: 20px; padding: 15px; background: rgba(0,230,118,0.1); border-radius: 8px;">
                        <!-- Resumo será preenchido dinamicamente -->
                    </div>
                </div>
                
                <div class="report-container">
                    <h3>Relatório de Projetos por Fase (Kanban)</h3>
                    <div class="kanban-board" id="kanban-board"></div>
                </div>
            </section>

            <section id="clientes" class="page">
                <h1><i class="ph ph-users"></i> Gestão de Clientes</h1>
                <button class="btn-primary" onclick="openClientModal()"><i class="ph ph-plus"></i> Adicionar Cliente</button>
                <div class="table-container" style="margin-top: 20px;">
                    <h3>Lista de Clientes</h3>
                    <div class="table-wrapper">
                        <table id="tabela-clientes">
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Email</th>
                                    <th>Telefone</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <section id="projetos" class="page">
                <h1><i class="ph ph-kanban"></i> Gestão de Projetos</h1>
                <button class="btn-primary" onclick="openProjectModal()"><i class="ph ph-plus"></i> Adicionar Projeto</button>
                <div class="table-container" style="margin-top: 20px;">
                    <h3>Lista de Projetos</h3>
                    <div class="table-wrapper">
                        <table id="tabela-projetos">
                            <thead>
                                <tr>
                                    <th>Projeto</th>
                                    <th>Cliente</th>
                                    <th>Link</th>
                                    <th>Fase Atual</th>
                                    <th>Status</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </section>
            
            <section id="financeiro" class="page">
                <h1><i class="ph ph-currency-circle-dollar"></i> Análise Financeira</h1>
                <button class="btn-primary" onclick="openFinancialModal()"><i class="ph ph-plus"></i> Adicionar Lançamento</button>
                <div class="report-container">
                    <div class="report-filters">
                        <label for="financial-period-filter">Exibir período:</label>
                        <select id="financial-period-filter" onchange="renderFinancialReport(this.value)">
                            <option value="esteMes">Este Mês</option>
                            <option value="mesPassado">Mês Passado</option>
                            <option value="esteAno">Este Ano</option>
                            <option value="todoPeriodo">Todo o Período</option>
                        </select>
                    </div>
                    <div class="financial-summary">
                        <div class="card receita">
                            <h3><i class="ph ph-arrow-circle-up"></i>Receitas</h3>
                            <p id="total-receitas">R$ 0,00</p>
                        </div>
                        <div class="card despesa">
                            <h3><i class="ph ph-arrow-circle-down"></i>Despesas</h3>
                            <p id="total-despesas">R$ 0,00</p>
                        </div>
                        <div class="card saldo">
                            <h3><i class="ph ph-scales"></i>Saldo</h3>
                            <p id="saldo-total">R$ 0,00</p>
                        </div>
                        <div class="card previsao">
                            <h3><i class="ph ph-trend-up"></i> Previsão</h3>
                            <p id="previsao-receita">R$ 0,00</p>
                        </div>
                    </div>
                </div>
                <div class="report-container">
                    <h2>Análise Gráfica e por Projeto</h2>
                    <div class="chart-container">
                        <div class="table-container" style="margin:0;">
                            <h4>Receitas por Projeto</h4>
                            <div class="table-wrapper">
                                <table id="tabela-receitas-projeto">
                                    <thead>
                                        <tr>
                                            <th>Projeto</th>
                                            <th>Receita Total</th>
                                        </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </div>
                        <div class="chart-wrapper">
                            <h4>Receitas vs. Despesas Mensais</h4>
                            <div class="chart" id="financial-chart"></div>
                        </div>
                    </div>
                </div>
                <div class="table-container">
                    <h3>Histórico Completo de Lançamentos</h3>
                    <div class="table-wrapper">
                        <table id="tabela-financeiro">
                            <thead>
                                <tr>
                                    <th>Descrição</th>
                                    <th>Valor</th>
                                    <th>Data</th>
                                    <th>Projeto</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody></tbody>
                        </table>
                    </div>
                </div>
            </section>

            <section id="contratos" class="page">
                <h1><i class="ph ph-file-text"></i> Gerador de Documentos</h1>
                <div class="generator-container">
                    <h3>Configuração do Documento</h3>
                    <div class="form-grid">
                        <select id="doc-cliente" onchange="populateProjectDropdown('doc-projeto', this.value)">
                            <option value="">1. Selecione o Cliente</option>
                        </select>
                        <select id="doc-projeto">
                            <option value="">2. Selecione o Projeto</option>
                        </select>
                    </div>
                    <div class="document-controls" style="margin-top: 20px; display: flex; flex-wrap: wrap; gap: 10px;">
                        <button class="btn-primary" onclick="generateContract()">
                            <i class="ph ph-file-text"></i> Gerar Contrato
                        </button>
                        <button class="btn-secondary" onclick="generateReceipt()">
                            <i class="ph ph-receipt"></i> Gerar Recibo
                        </button>
                        <button id="btn-print" class="btn-warning" style="display: none;" onclick="window.print()">
                            <i class="ph ph-printer"></i> Imprimir / Salvar PDF
                        </button>
                    </div>
                </div>
                <div id="documento-preview">
                    <div style="text-align: center; color: #777; padding: 40px 20px;">
                        <i class="ph ph-file-dashed" style="font-size: 4rem;"></i>
                        <p>Selecione um cliente e um projeto para gerar um documento.</p>
                    </div>
                </div>
            </section>

            <section id="configuracoes" class="page">
                <h1><i class="ph ph-gear"></i> Configurações da Empresa</h1>
                <div class="form-container">
                    <h3>Dados da Empresa</h3>
                    <form id="form-configuracoes" class="form-grid">
                        <div>
                            <label for="config-nome-completo">Nome Completo (Responsável)</label>
                            <input type="text" id="config-nome-completo" placeholder="Seu Nome Completo">
                        </div>
                        <div>
                            <label for="config-cnpj">CNPJ</label>
                            <input type="text" id="config-cnpj" placeholder="00.000.000/0000-00">
                        </div>
                        <div>
                            <label for="config-razao-social">Razão Social</label>
                            <input type="text" id="config-razao-social" placeholder="Razão Social da Sua Empresa">
                        </div>
                        <div>
                            <label for="config-nome-fantasia">Nome Fantasia</label>
                            <input type="text" id="config-nome-fantasia" placeholder="Nome Fantasia da Sua Empresa">
                        </div>
                        <div class="logo-upload-container" style="grid-column: 1 / -1;">
                            <label for="config-logo">Logomarca (PNG, JPG)</label>
                            <input type="file" id="config-logo" accept="image/png, image/jpeg">
                            <img id="logo-preview" src="#" alt="Prévia da Logomarca" style="display: none; max-width: 200px; margin-top: 10px;">
                        </div>
                        <div style="grid-column: 1 / -1;">
                            <button type="submit" class="btn-primary">Salvar Configurações</button>
                        </div>
                    </form>
                </div>
                
                <h2><i class="ph ph-database"></i> Backup e Restauração</h2>
                <div class="backup-section" style="background-color: var(--card-background); padding: 20px; border-radius: 12px; margin-bottom: 20px;">
                    <div style="display: flex; flex-wrap: wrap; gap: 15px; align-items: center;">
                        <button class="btn-primary" onclick="exportBackup()">
                            <i class="ph ph-download-simple"></i> Exportar Backup
                        </button>
                        <div style="display: flex; flex-wrap: wrap; gap: 10px; align-items: center;">
                            <label for="import-file">Importar Backup:</label>
                            <input type="file" id="import-file" accept=".json">
                            <button class="btn-secondary" onclick="importBackup()">Carregar</button>
                        </div>
                    </div>
                </div>
                <button class="btn-danger" onclick="clearAllData()">
                    <i class="ph ph-trash"></i> Limpar Todos os Dados
                </button>
            </section>
        </main>
    </div>

    <!-- Modais (mantidos da versão original) -->
    <div id="clientModal" class="modal">
        <div class="modal-content">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid var(--cor-borda); padding-bottom: 15px;">
                <h3 id="clientModalTitle">Adicionar Cliente</h3>
                <span style="color: var(--cor-texto); font-size: 28px; cursor: pointer; transition: color 0.3s;" onclick="closeClientModal()">&times;</span>
            </div>
            <form id="form-cliente" class="form-grid">
                <input type="hidden" id="cliente-id">
                <input type="text" id="cliente-nome" placeholder="Nome Completo" required>
                <input type="email" id="cliente-email" placeholder="E-mail" required>
                <input type="tel" id="cliente-telefone" placeholder="Telefone">
                <input type="text" id="cliente-documento" placeholder="CPF/CNPJ">
                <div style="grid-column: 1 / -1; display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                    <button type="button" class="btn-secondary" onclick="closeClientModal()">Cancelar</button>
                    <button type="submit" class="btn-primary">Salvar Cliente</button>
                </div>
            </form>
        </div>
    </div>

    <div id="projectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid var(--cor-borda); padding-bottom: 15px;">
                <h3 id="projectModalTitle">Adicionar Projeto</h3>
                <span style="color: var(--cor-texto); font-size: 28px; cursor: pointer; transition: color 0.3s;" onclick="closeProjectModal()">&times;</span>
            </div>
            <form id="form-projeto" class="form-grid">
                <input type="hidden" id="projeto-id">
                <input type="text" id="projeto-nome" placeholder="Nome do Projeto" required>
                <select id="projeto-cliente" required><option value="">Selecione um Cliente</option></select>
                <input type="number" id="projeto-valor" placeholder="Valor do Projeto (R$)" step="0.01" required>
                <select id="projeto-status" required>
                    <option value="planejamento">Planejamento</option>
                    <option value="andamento">Em Andamento</option>
                    <option value="concluido">Concluído</option>
                    <option value="cancelado">Cancelado</option>
                </select>
                <select id="projeto-fase" required>
                    <option value="Análise">Fase: Análise</option>
                    <option value="Design (UI/UX)">Fase: Design (UI/UX)</option>
                    <option value="Desenvolvimento">Fase: Desenvolvimento</option>
                    <option value="Testes">Fase: Testes</option>
                    <option value="Implantação">Fase: Implantação</option>
                </select>
                <div>
                    <label for="projeto-data-inicio">Data de Início</label>
                    <input type="date" id="projeto-data-inicio">
                </div>
                <div>
                    <label for="projeto-data-fim">Data de Fim</label>
                    <input type="date" id="projeto-data-fim">
                </div>
                <div>
                    <label for="projeto-duracao-dias">Duração Estimada (Dias)</label>
                    <input type="number" id="projeto-duracao-dias" placeholder="Ex: 30" min="1">
                </div>
                <div>
                    <label for="projeto-progresso">Progresso (%)</label>
                    <input type="number" id="projeto-progresso" placeholder="0-100" min="0" max="100" value="0">
                </div>
                <div>
                    <label for="projeto-link">Link do Projeto (URL)</label>
                    <input type="url" id="projeto-link" placeholder="https://exemplo.com/projeto">
                </div>
                <div style="grid-column: 1 / -1;">
                    <label for="projeto-descricao">Descrição do Projeto</label>
                    <textarea id="projeto-descricao" placeholder="Descrição do Projeto..." rows="4"></textarea>
                </div>
                <div style="grid-column: 1 / -1; display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                    <button type="button" class="btn-secondary" onclick="closeProjectModal()">Cancelar</button>
                    <button type="submit" class="btn-primary">Salvar Projeto</button>
                </div>
            </form>
        </div>
    </div>

    <div id="financialModal" class="modal">
        <div class="modal-content">
            <div class="modal-header" style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid var(--cor-borda); padding-bottom: 15px;">
                <h3 id="financialModalTitle">Adicionar Lançamento</h3>
                <span style="color: var(--cor-texto); font-size: 28px; cursor: pointer; transition: color 0.3s;" onclick="closeFinancialModal()">&times;</span>
            </div>
            <form id="form-financeiro" class="form-grid">
                <input type="hidden" id="lancamento-id">
                <input type="text" id="lancamento-descricao" placeholder="Descrição (Ex: Adiantamento)" required>
                <input type="number" id="lancamento-valor" placeholder="Valor (R$)" step="0.01" required>
                <select id="lancamento-tipo" required>
                    <option value="receita">Receita</option>
                    <option value="despesa">Despesa</option>
                </select>
                <input type="date" id="lancamento-data" required>
                <select id="lancamento-projeto">
                    <option value="">Vincular a um Projeto (Opcional)</option>
                </select>
                <div style="grid-column: 1 / -1; display: flex; justify-content: flex-end; gap: 10px; margin-top: 20px;">
                    <button type="button" class="btn-secondary" onclick="closeFinancialModal()">Cancelar</button>
                    <button type="submit" class="btn-primary">Adicionar Lançamento</button>
                </div>
            </form>
        </div>
    </div>

<script>
// ================================================================================= //
// =============================== INÍCIO DO SCRIPT ================================ //
// ================================================================================= //
let projectStatusChartInstance = null;
const defaultDB = { clientes: [], projetos: [], financeiro: [], empresa: {} };
let db = {};
let currentFilter = null;
let currentReportData = null;

document.addEventListener('DOMContentLoaded', () => {
    initializeApp();
    
    document.getElementById('form-cliente')?.addEventListener('submit', handleClientFormSubmit);
    document.getElementById('form-projeto')?.addEventListener('submit', handleProjectFormSubmit);
    document.getElementById('form-financeiro')?.addEventListener('submit', handleFinancialFormSubmit);
    document.getElementById('form-configuracoes')?.addEventListener('submit', handleConfigFormSubmit);
    document.getElementById('config-logo')?.addEventListener('change', previewLogo);
    document.getElementById('date-range')?.addEventListener('change', toggleCustomDateRange);
    
    // Responsividade - ajustar sidebar em mobile
    window.addEventListener('resize', handleResize);
    handleResize();
});

function initializeApp() {
    const dataFromStorage = localStorage.getItem('gestorProDB');
    db = dataFromStorage ? JSON.parse(dataFromStorage) : { ...defaultDB };
    if (!db.empresa) db.empresa = {};
    
    if (localStorage.getItem('first_run_completed') === null) {
        localStorage.setItem('first_run_completed', 'true');
        clearAllData(true);
    } else {
        showPage('dashboard');
        renderAllData();
        loadConfigData();
    }
}

function handleResize() {
    const sidebarNav = document.getElementById('sidebar-nav');
    const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
    
    if (window.innerWidth <= 768) {
        // Em mobile, esconder menu por padrão
        sidebarNav.style.maxHeight = '0';
        mobileMenuBtn.style.display = 'block';
    } else {
        // Em desktop, mostrar sempre
        sidebarNav.style.maxHeight = 'none';
        mobileMenuBtn.style.display = 'none';
    }
}

function toggleSidebar() {
    const sidebarNav = document.getElementById('sidebar-nav');
    if (sidebarNav.style.maxHeight === '0px' || sidebarNav.style.maxHeight === '') {
        sidebarNav.style.maxHeight = '500px';
    } else {
        sidebarNav.style.maxHeight = '0';
    }
}

function saveData() {
    localStorage.setItem('gestorProDB', JSON.stringify(db));
    renderAllData();
}

function renderAllData() {
    renderClientsTable();
    renderProjectsTable();
    renderAllFinancialTransactionsTable();
    renderFinancialReport(document.getElementById('financial-period-filter').value);
    renderPhaseReport();
    updateDashboard();
    updateFinancialForecast();
    renderProjectStatusChart();
    populateClientDropdown('projeto-cliente');
    populateClientDropdown('doc-cliente');
    populateProjectDropdown('lancamento-projeto');
    populateProjectDropdown('doc-projeto', document.getElementById('doc-cliente').value);
    loadConfigData();
}

function showPage(pageId) {
    document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
    document.querySelectorAll('.sidebar nav button').forEach(button => {
        button.classList.remove('active');
        if (button.getAttribute('onclick').includes(pageId)) button.classList.add('active');
    });
    
    // Fechar menu mobile ao navegar
    if (window.innerWidth <= 768) {
        document.getElementById('sidebar-nav').style.maxHeight = '0';
    }
    
    if (currentFilter && pageId === 'projetos') {
        applyProjectFilter(currentFilter);
        currentFilter = null;
    }
    
    if (pageId === 'dashboard') {
        updateDashboard();
        renderProjectStatusChart();
    } else if (pageId === 'financeiro') {
        renderFinancialReport(document.getElementById('financial-period-filter').value);
        updateFinancialForecast();
    } else if (pageId === 'relatorios') {
        renderPhaseReport();
    }
}

function navigateTo(page, filter = null) {
    if (filter) {
        currentFilter = filter;
    }
    showPage(page);
}

function applyProjectFilter(status) {
    const tableBody = document.querySelector('#projetos #tabela-projetos tbody');
    const rows = tableBody.querySelectorAll('tr');
    
    rows.forEach(row => {
        const statusCell = row.querySelector('.status');
        if (statusCell) {
            const rowStatus = statusCell.className.split(' ')[1];
            if (status === rowStatus) {
                row.style.display = '';
            } else {
                row.style.display = 'none';
            }
        }
    });
    
    const tableContainer = document.querySelector('#projetos .table-container');
    let filterIndicator = tableContainer.querySelector('.filter-indicator');
    
    if (!filterIndicator) {
        filterIndicator = document.createElement('div');
        filterIndicator.className = 'filter-indicator';
        filterIndicator.style.cssText = 'background: var(--cor-primaria); color: var(--cor-fundo); padding: 8px 15px; border-radius: 5px; margin-bottom: 15px; display: inline-flex; align-items: center; gap: 8px;';
        tableContainer.insertBefore(filterIndicator, tableContainer.querySelector('.table-wrapper'));
    }
    
    const statusNames = {
        'planejamento': 'Planejamento',
        'andamento': 'Em Andamento',
        'concluido': 'Concluídos',
        'cancelado': 'Cancelados'
    };
    
    filterIndicator.innerHTML = `
        <i class="ph ph-funnel"></i>
        Filtro aplicado: ${statusNames[status]}
        <button onclick="clearFilter()" style="background: none; border: none; color: var(--cor-fundo); cursor: pointer; margin-left: 10px;">
            <i class="ph ph-x"></i>
        </button>
    `;
}

function clearFilter() {
    const tableBody = document.querySelector('#projetos #tabela-projetos tbody');
    const rows = tableBody.querySelectorAll('tr');
    
    rows.forEach(row => {
        row.style.display = '';
    });
    
    const filterIndicator = document.querySelector('.filter-indicator');
    if (filterIndicator) {
        filterIndicator.remove();
    }
}

const formatCurrency = (value) => (value || 0).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
const formatDate = (dateString) => dateString ? new Date(dateString + 'T00:00:00').toLocaleDateString('pt-BR', {timeZone: 'UTC'}) : 'N/A';
const getNomeCompleto = () => db.empresa.nomeCompleto || "Seu Nome Completo";
const getSeuDocumento = () => db.empresa.cnpj || "00.000.000/0001-00";
const getRazaoSocial = () => db.empresa.razaoSocial || "Sua Razão Social Ltda.";
const getNomeFantasia = () => db.empresa.nomeFantasia || "Seu Nome Fantasia";
const getLogomarca = () => db.empresa.logomarca || null;

function openClientModal() {
    document.getElementById('clientModal').style.display = 'block';
    document.getElementById('clientModalTitle').textContent = 'Adicionar Cliente';
    document.getElementById('form-cliente').reset();
    document.getElementById('cliente-id').value = '';
}

function closeClientModal() {
    document.getElementById('clientModal').style.display = 'none';
}

function openProjectModal() {
    document.getElementById('projectModal').style.display = 'block';
    document.getElementById('projectModalTitle').textContent = 'Adicionar Projeto';
    document.getElementById('form-projeto').reset();
    document.getElementById('projeto-id').value = '';
    populateClientDropdown('projeto-cliente');
}

function closeProjectModal() {
    document.getElementById('projectModal').style.display = 'none';
}

function openFinancialModal() {
    document.getElementById('financialModal').style.display = 'block';
    document.getElementById('financialModalTitle').textContent = 'Adicionar Lançamento';
    document.getElementById('form-financeiro').reset();
    document.getElementById('lancamento-id').value = '';
    populateProjectDropdown('lancamento-projeto');
}

function closeFinancialModal() {
    document.getElementById('financialModal').style.display = 'none';
}

window.onclick = function(event) {
    const clientModal = document.getElementById('clientModal');
    const projectModal = document.getElementById('projectModal');
    const financialModal = document.getElementById('financialModal');
    
    if (event.target === clientModal) closeClientModal();
    if (event.target === projectModal) closeProjectModal();
    if (event.target === financialModal) closeFinancialModal();
}

// Funções existentes para manipulação de dados
function renderFinancialReport(period = 'esteMes') {
    const transactions = period === 'todoPeriodo' ? db.financeiro : getTransactionsByPeriod(period);
    const totalReceitas = transactions.filter(t => t.tipo === 'receita').reduce((sum, t) => sum + t.valor, 0);
    const totalDespesas = transactions.filter(t => t.tipo === 'despesa').reduce((sum, t) => sum + t.valor, 0);
    document.getElementById('total-receitas').textContent = formatCurrency(totalReceitas);
    document.getElementById('total-despesas').textContent = formatCurrency(totalDespesas);
    document.getElementById('saldo-total').textContent = formatCurrency(totalReceitas - totalDespesas);
    
    const receitaPorProjeto = transactions.filter(t => t.tipo === 'receita' && t.projetoId).reduce((acc, t) => { 
        acc[t.projetoId] = (acc[t.projetoId] || 0) + t.valor; 
        return acc; 
    }, {});
    
    const tabelaReceitasBody = document.querySelector('#tabela-receitas-projeto tbody');
    tabelaReceitasBody.innerHTML = '';
    
    for (const projetoId in receitaPorProjeto) {
        const projeto = db.projetos.find(p => p.id === projetoId);
        if (projeto) {
            tabelaReceitasBody.insertRow().innerHTML = `
                <td>${projeto.nome}</td>
                <td>${formatCurrency(receitaPorProjeto[projetoId])}</td>
            `;
        }
    }
    
    renderMonthlyChart(transactions);
}

function getTransactionsByPeriod(period) {
    const now = new Date();
    let startDate, endDate;
    
    if (period === 'esteMes') {
        startDate = new Date(now.getFullYear(), now.getMonth(), 1);
        endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
    } else if (period === 'mesPassado') {
        startDate = new Date(now.getFullYear(), now.getMonth() - 1, 1);
        endDate = new Date(now.getFullYear(), now.getMonth(), 0);
    } else if (period === 'esteAno') {
        startDate = new Date(now.getFullYear(), 0, 1);
        endDate = new Date(now.getFullYear(), 11, 31);
    } else {
        return db.financeiro;
    }
    
    return db.financeiro.filter(t => {
        const transactionDate = new Date(t.data + 'T00:00:00');
        return transactionDate >= startDate && transactionDate <= endDate;
    });
}

function renderMonthlyChart(transactions) {
    const chart = document.getElementById('financial-chart');
    chart.innerHTML = '';
    
    const dataByMonth = transactions.reduce((acc, t) => {
        const month = t.data.substring(0, 7);
        if (!acc[month]) acc[month] = { receita: 0, despesa: 0 };
        acc[month][t.tipo] += t.valor;
        return acc;
    }, {});
    
    const sortedMonths = Object.keys(dataByMonth).sort();
    
    if (sortedMonths.length === 0) {
        chart.innerHTML = '<p style="font-size:0.9rem; color:#777; text-align:center; width:100%;">Sem dados para exibir no período.</p>';
        return;
    }
    
    const maxVal = Math.max(1, ...Object.values(dataByMonth).flatMap(d => [d.receita, d.despesa]));
    
    sortedMonths.forEach(month => {
        const { receita, despesa } = dataByMonth[month];
        const monthLabel = new Date(month + '-02').toLocaleDateString('pt-BR', { month: 'short', year: '2-digit' });
        
        const group = document.createElement('div');
        group.className = 'chart-bar-group';
        group.innerHTML = `
            <div class="chart-bar receita" style="height: ${(receita/maxVal)*100}%" title="Receita: ${formatCurrency(receita)}"></div>
            <div class="chart-bar despesa" style="height: ${(despesa/maxVal)*100}%" title="Despesa: ${formatCurrency(despesa)}"></div>
            <div class="chart-label">${monthLabel}</div>
        `;
        
        chart.appendChild(group);
    });
}

// Restante das funções existentes (handleClientFormSubmit, renderClientsTable, etc.)
function handleClientFormSubmit(e) {
    e.preventDefault();
    const form = e.target;
    if (!form.checkValidity()) { form.reportValidity(); return; }
    
    const id = document.getElementById('cliente-id').value;
    const data = {
        nome: form['cliente-nome'].value,
        email: form['cliente-email'].value,
        telefone: form['cliente-telefone'].value,
        documento: form['cliente-documento'].value
    };
    
    if (id) {
        const index = db.clientes.findIndex(c => c.id === id);
        if (index > -1) db.clientes[index] = { ...db.clientes[index], ...data };
    } else {
        db.clientes.push({ id: 'cli_' + Date.now(), ...data });
    }
    
    saveData();
    closeClientModal();
}

function renderClientsTable() {
    const tableBody = document.querySelector('#clientes #tabela-clientes tbody');
    tableBody.innerHTML = '';
    
    db.clientes.forEach(c => {
        const r = tableBody.insertRow();
        r.innerHTML = `
            <td>${c.nome}</td>
            <td>${c.email}</td>
            <td>${c.telefone}</td>
            <td class="actions">
                <button class="edit" onclick="editClient('${c.id}')"><i class="ph ph-pencil-simple"></i></button>
                <button class="delete" onclick="deleteClient('${c.id}')"><i class="ph ph-trash"></i></button>
            </td>
        `;
    });
}

function editClient(id) {
    const c = db.clientes.find(c => c.id === id);
    if (!c) return;
    
    const form = document.getElementById('form-cliente');
    form['cliente-id'].value = c.id;
    form['cliente-nome'].value = c.nome;
    form['cliente-email'].value = c.email;
    form['cliente-telefone'].value = c.telefone;
    form['cliente-documento'].value = c.documento;
    
    document.getElementById('clientModalTitle').textContent = 'Editar Cliente';
    document.getElementById('clientModal').style.display = 'block';
    showPage('clientes');
    window.scrollTo(0,0);
}

function deleteClient(id) {
    if (confirm('Tem certeza? Excluir um cliente também excluirá seus projetos e lançamentos financeiros!')) {
        const projetosDoCliente = db.projetos.filter(p => p.clienteId === id).map(p => p.id);
        db.clientes = db.clientes.filter(c => c.id !== id);
        db.projetos = db.projetos.filter(p => p.clienteId !== id);
        db.financeiro = db.financeiro.filter(f => !projetosDoCliente.includes(f.projetoId));
        saveData();
    }
}

function handleProjectFormSubmit(e) {
    e.preventDefault();
    const form = e.target;
    if (!form.checkValidity()) { form.reportValidity(); return; }
    
    const id = form['projeto-id'].value;
    const data = {
        nome: form['projeto-nome'].value,
        clienteId: form['projeto-cliente'].value,
        valor: parseFloat(form['projeto-valor'].value),
        status: form['projeto-status'].value,
        fase: form['projeto-fase'].value,
        dataInicio: form['projeto-data-inicio'].value,
        dataFim: form['projeto-data-fim'].value,
        descricao: form['projeto-descricao'].value,
        duracaoDias: parseInt(form['projeto-duracao-dias'].value) || 0,
        progresso: parseInt(form['projeto-progresso'].value) || 0,
        link: form['projeto-link'].value
    };
    
    if (id) {
        const index = db.projetos.findIndex(p => p.id === id);
        if (index > -1) db.projetos[index] = { ...db.projetos[index], ...data };
    } else {
        db.projetos.push({ id: 'proj_' + Date.now(), ...data });
    }
    
    saveData();
    closeProjectModal();
}

function editProject(id) {
    const p = db.projetos.find(p => p.id === id);
    if (!p) return;
    
    const form = document.getElementById('form-projeto');
    form['projeto-id'].value = p.id;
    form['projeto-nome'].value = p.nome;
    form['projeto-cliente'].value = p.clienteId;
    form['projeto-valor'].value = p.valor;
    form['projeto-status'].value = p.status;
    form['projeto-fase'].value = p.fase || 'Análise';
    form['projeto-data-inicio'].value = p.dataInicio;
    form['projeto-data-fim'].value = p.dataFim;
    form['projeto-descricao'].value = p.descricao;
    form['projeto-duracao-dias'].value = p.duracaoDias || '';
    form['projeto-progresso'].value = p.progresso || 0;
    form['projeto-link'].value = p.link || '';
    
    document.getElementById('projectModalTitle').textContent = 'Editar Projeto';
    document.getElementById('projectModal').style.display = 'block';
    showPage('projetos');
    window.scrollTo(0, 0);
}

function deleteProject(id) {
    if (confirm('Tem certeza?')) {
        db.projetos = db.projetos.filter(p => p.id !== id);
        db.financeiro = db.financeiro.filter(f => f.projetoId !== id);
        saveData();
    }
}

function renderProjectsTable() {
    const tableBody = document.querySelector('#projetos #tabela-projetos tbody');
    tableBody.innerHTML = '';
    
    db.projetos.forEach(p => {
        const cliente = db.clientes.find(c => c.id === p.clienteId);
        let linkHtml = 'N/A';
        
        if (p.link) {
            const domain = p.link.replace(/^https?:\/\/(www\.)?/, '').split('/')[0];
            linkHtml = `<a href="${p.link}" target="_blank" class="project-link" title="${p.link}"><i class="ph ph-link"></i> ${domain}</a>`;
        }
        
        const r = tableBody.insertRow();
        r.innerHTML = `
            <td>${p.nome}</td>
            <td>${cliente ? cliente.nome : 'N/A'}</td>
            <td>${linkHtml}</td>
            <td>${p.fase || 'N/A'}</td>
            <td><span class="status ${p.status}">${p.status.charAt(0).toUpperCase() + p.status.slice(1)}</span></td>
            <td class="actions">
                <button class="edit" onclick="editProject('${p.id}')"><i class="ph ph-pencil-simple"></i></button>
                <button class="delete" onclick="deleteProject('${p.id}')"><i class="ph ph-trash"></i></button>
            </td>
        `;
    });
}

function handleFinancialFormSubmit(e) {
    e.preventDefault();
    const form = e.target;
    if (!form.checkValidity()) { form.reportValidity(); return; }
    
    const id = form['lancamento-id'].value;
    const data = {
        descricao: form['lancamento-descricao'].value,
        valor: parseFloat(form['lancamento-valor'].value),
        tipo: form['lancamento-tipo'].value,
        data: form['lancamento-data'].value,
        projetoId: form['lancamento-projeto'].value
    };
    
    if (id) {
        const index = db.financeiro.findIndex(f => f.id === id);
        if (index > -1) db.financeiro[index] = { ...db.financeiro[index], ...data };
    } else {
        db.financeiro.push({ id: 'fin_' + Date.now(), ...data });
    }
    
    saveData();
    closeFinancialModal();
}

function renderAllFinancialTransactionsTable() {
    const tableBody = document.getElementById('tabela-financeiro').querySelector('tbody');
    tableBody.innerHTML = '';
    
    db.financeiro.forEach(f => {
        const projeto = db.projetos.find(p => p.id === f.projetoId);
        const row = tableBody.insertRow();
        row.innerHTML = `
            <td>${f.descricao}</td>
            <td class="valor ${f.tipo}">${formatCurrency(f.valor)}</td>
            <td>${formatDate(f.data)}</td>
            <td>${projeto ? projeto.nome : 'N/A'}</td>
            <td class="actions">
                <button class="edit" onclick="editFinancial('${f.id}')"><i class="ph ph-pencil-simple"></i></button>
                <button class="delete" onclick="deleteFinancial('${f.id}')"><i class="ph ph-trash"></i></button>
            </td>
        `;
    });
}

function editFinancial(id) {
    const f = db.financeiro.find(f => f.id === id);
    if (!f) return;
    
    const form = document.getElementById('form-financeiro');
    form['lancamento-id'].value = f.id;
    form['lancamento-descricao'].value = f.descricao;
    form['lancamento-valor'].value = f.valor;
    form['lancamento-tipo'].value = f.tipo;
    form['lancamento-data'].value = f.data;
    form['lancamento-projeto'].value = f.projetoId;
    
    document.getElementById('financialModalTitle').textContent = 'Editar Lançamento';
    document.getElementById('financialModal').style.display = 'block';
    showPage('financeiro');
    window.scrollTo(0,0);
}

function deleteFinancial(id) {
    if (confirm('Tem certeza?')) {
        db.financeiro = db.financeiro.filter(f => f.id !== id);
        saveData();
    }
}

function populateClientDropdown(elementId) {
    const select = document.getElementById(elementId);
    const val = select.value;
    select.innerHTML = `<option value="">Selecione um Cliente</option>`;
    db.clientes.forEach(c => select.add(new Option(c.nome, c.id)));
    select.value = val;
}

function populateProjectDropdown(elementId, filterByClientId = null) {
    const select = document.getElementById(elementId);
    const val = select.value;
    select.innerHTML = `<option value="">Selecione um Projeto</option>`;
    
    let projetos = filterByClientId ? 
        db.projetos.filter(p => p.clienteId === filterByClientId) : 
        db.projetos;
    
    projetos.forEach(p => select.add(new Option(p.nome, p.id)));
    select.value = val;
}

function updateDashboard() {
    document.getElementById('total-clientes').textContent = db.clientes.length;
    document.getElementById('total-projetos-geral').textContent = db.projetos.length;
    document.getElementById('total-projetos-planejamento').textContent = db.projetos.filter(p => p.status === 'planejamento').length;
    document.getElementById('total-projetos-andamento-dashboard').textContent = db.projetos.filter(p => p.status === 'andamento').length;
    document.getElementById('total-projetos-concluido').textContent = db.projetos.filter(p => p.status === 'concluido').length;
    document.getElementById('total-projetos-cancelado').textContent = db.projetos.filter(p => p.status === 'cancelado').length;
}

function updateFinancialForecast() {
    const forecastTotal = db.projetos
        .filter(p => p.status === 'planejamento' || p.status === 'andamento')
        .reduce((sum, p) => sum + (p.valor || 0), 0);
    
    document.getElementById('previsao-receita').textContent = formatCurrency(forecastTotal);
}

function renderPhaseReport() {
    const kanbanBoard = document.getElementById('kanban-board');
    if(!kanbanBoard) return;
    
    kanbanBoard.innerHTML = '';
    const fases = ['Análise', 'Design (UI/UX)', 'Desenvolvimento', 'Testes', 'Implantação'];
    
    fases.forEach(fase => {
        const projetosNestaFase = db.projetos.filter(p => p.fase === fase && p.status !== 'concluido' && p.status !== 'cancelado');
        const column = document.createElement('div');
        column.className = 'kanban-column';
        
        let cardsHtml = '';
        if (projetosNestaFase.length > 0) {
            projetosNestaFase.forEach(p => {
                const c = db.clientes.find(c => c.id === p.clienteId);
                const duracaoHtml = p.duracaoDias ? `<p class="project-duration-clock"><i class="ph ph-hourglass"></i> ${p.duracaoDias} dias</p>` : '';
                const progressoHtml = `<div class="project-progress-bar-container"><div class="project-progress-bar" style="width: ${p.progresso || 0}%">${p.progresso || 0}%</div></div>`;
                
                cardsHtml += `
                    <div class="kanban-card" onclick="editProject('${p.id}')">
                        <h5>${p.nome}</h5>
                        <p><i class="ph ph-user"></i> ${c ? c.nome : 'N/A'}</p>
                        <p><i class="ph ph-currency-circle-dollar"></i> ${formatCurrency(p.valor)}</p>
                        ${duracaoHtml}
                        ${progressoHtml}
                    </div>`;
            });
        } else {
            cardsHtml = '<p style="font-size: 0.8rem; color: #777; text-align: center; padding: 15px;">Nenhum projeto aqui.</p>';
        }
        
        column.innerHTML = `
            <div class="kanban-column-header"><h4>${fase}</h4><span class="count">${projetosNestaFase.length}</span></div>
            <div class="kanban-column-body">${cardsHtml}</div>`;
        
        kanbanBoard.appendChild(column);
    });
}

function renderProjectStatusChart() {
    const ctx = document.getElementById('projectStatusChart');
    if (projectStatusChartInstance) projectStatusChartInstance.destroy();
    
    const statusCounts = db.projetos.reduce((acc, p) => {
        acc[p.status] = (acc[p.status] || 0) + 1;
        return acc;
    }, {});
    
    projectStatusChartInstance = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Planejamento', 'Em Andamento', 'Concluído', 'Cancelado'],
            datasets: [{
                data: [
                    statusCounts.planejamento || 0,
                    statusCounts.andamento || 0,
                    statusCounts.concluido || 0,
                    statusCounts.cancelado || 0
                ],
                backgroundColor: [
                    'rgba(255, 234, 0, 0.7)',
                    'rgba(0, 230, 118, 0.7)',
                    'rgba(0, 200, 83, 0.7)',
                    'rgba(255, 82, 82, 0.7)'
                ],
                borderColor: [
                    'rgb(255, 234, 0)',
                    'rgb(0, 230, 118)',
                    'rgb(0, 200, 83)',
                    'rgb(255, 82, 82)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        color: 'var(--cor-texto)',
                        font: { size: 14 }
                    }
                },
                tooltip: {
                    callbacks: {
                        label: (c) => `${c.label || ''}: ${c.parsed || 0} projetos`
                    }
                }
            }
        }
    });
}

function generateContract() {
    const cId = document.getElementById('doc-cliente').value;
    const pId = document.getElementById('doc-projeto').value;
    
    if (!cId || !pId) {
        alert('Selecione cliente e projeto.');
        return;
    }
    
    const c = db.clientes.find(c => c.id === cId);
    const p = db.projetos.find(p => p.id === pId);
    const logoHtml = getLogomarca() ? `<img src="${getLogomarca()}" alt="Logomarca da Empresa" style="max-width: 150px;">` : '';
    
    document.getElementById('documento-preview').innerHTML = `
        <div class="doc-header">
            ${logoHtml}
            <h3>CONTRATO DE PRESTAÇÃO DE SERVIÇOS</h3>
            <p>${getRazaoSocial()} (${getNomeFantasia()}) - CNPJ: ${getSeuDocumento()}</p>
        </div>
        <div class="doc-section">
            <h4>PARTES CONTRATANTES</h4>
            <p><strong>CONTRATANTE:</strong> ${c.nome.toUpperCase()}, CPF/CNPJ: ${c.documento || '[não informado]'}.</p>
            <p><strong>CONTRATADO(A):</strong> ${getNomeCompleto().toUpperCase()}, CPF/CNPJ: ${getSeuDocumento()}.</p>
        </div>
        <div class="doc-section">
            <h4>CLÁUSULAS E CONDIÇÕES</h4>
            <ol>
                <li><strong>DO OBJETO:</strong> Prestação de serviços de desenvolvimento para o projeto <strong>"${p.nome}"</strong>. Escopo: ${p.descricao || 'Conforme proposta.'}</li>
                <li><strong>DO VALOR:</strong> O valor total é de <strong>${formatCurrency(p.valor)}</strong>.</li>
                <li><strong>DO PRAZO:</strong> De ${formatDate(p.dataInicio)} a ${formatDate(p.dataFim)}.</li>
                <li><strong>DO FORO:</strong> Fica eleito o foro da comarca de Maceió/AL.</li>
            </ol>
        </div>
        <p>E, por estarem justos e contratados, assinam o presente.</p>
        <div class="doc-signatures">
            <div class="doc-signature-block">
                <div class="doc-signature-line"></div>
                <div class="doc-signature-name">${getNomeCompleto()}</div>
                <div class="doc-signature-name">CONTRATADO(A)</div>
            </div>
            <div class="doc-signature-block">
                <div class="doc-signature-line"></div>
                <div class="doc-signature-name">${c.nome}</div>
                <div class="doc-signature-name">CONTRATANTE</div>
            </div>
        </div>
    `;
    
    document.getElementById('btn-print').style.display = 'inline-block';
}

function generateReceipt() {
    const cId = document.getElementById('doc-cliente').value;
    const pId = document.getElementById('doc-projeto').value;
    
    if (!cId || !pId) {
        alert('Selecione cliente e projeto.');
        return;
    }
    
    const c = db.clientes.find(c => c.id === cId);
    const p = db.projetos.find(p => p.id === pId);
    const logoHtml = getLogomarca() ? `<img src="${getLogomarca()}" alt="Logomarca da Empresa" style="max-width: 150px;">` : '';
    
    document.getElementById('documento-preview').innerHTML = `
        <div class="doc-header">
            ${logoHtml}
            <h3>RECIBO DE PAGAMENTO</h3>
            <p>Recibo Nº: REC-${Date.now().toString().slice(-6)}</p>
            <p>${getRazaoSocial()} (${getNomeFantasia()}) - CNPJ: ${getSeuDocumento()}</p>
        </div>
        <div class="doc-section">
            <h4>DADOS DO PAGAMENTO</h4>
            <p>Recebemos de <strong>${c.nome.toUpperCase()}</strong> (CPF/CNPJ: ${c.documento || '[não informado]'}) a importância descrita abaixo.</p>
        </div>
        <div class="doc-receipt-value">
            <p>${formatCurrency(p.valor)}</p>
        </div>
        <p>Valor referente ao projeto <strong>"${p.nome}"</strong>.</p>
        <p>Para clareza, firmamos o presente.</p>
        <div class="doc-signatures" style="margin-top: 120px;">
            <div class="doc-signature-block">
                <div class="doc-signature-line"></div>
                <div class="doc-signature-name">${getNomeCompleto()}</div>
                <div class="doc-signature-name">Emitente</div>
            </div>
        </div>
        <div style="text-align: center; margin-top: 40px;">
            <p>Maceió, ${new Date().toLocaleDateString('pt-BR', { day: '2-digit', month: 'long', year: 'numeric' })}.</p>
        </div>
    `;
    
    document.getElementById('btn-print').style.display = 'inline-block';
}

function exportBackup() {
    const dataStr = JSON.stringify(db, null, 2);
    const dataBlob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(dataBlob);
    const link = document.createElement('a');
    
    link.href = url;
    link.download = `backup-gestorpro-${new Date().toISOString().split('T')[0]}.json`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
}

function importBackup() {
    const fileInput = document.getElementById('import-file');
    const file = fileInput.files[0];
    
    if (!file) {
        alert('Selecione um arquivo.');
        return;
    }
    
    const reader = new FileReader();
    reader.onload = (e) => {
        try {
            const data = JSON.parse(e.target.result);
            if (confirm('Isso substituirá todos os dados. Continuar?')) {
                db = { ...defaultDB, ...data };
                saveData();
                alert('Backup importado!');
            }
        } catch (err) {
            alert('Erro no arquivo.');
        } finally {
            fileInput.value = '';
        }
    };
    
    reader.readAsText(file);
}

function handleConfigFormSubmit(e) {
    e.preventDefault();
    const form = e.target;
    if (!form.checkValidity()) { form.reportValidity(); return; }
    
    const configData = {
        nomeCompleto: form['config-nome-completo'].value,
        cnpj: form['config-cnpj'].value,
        razaoSocial: form['config-razao-social'].value,
        nomeFantasia: form['config-nome-fantasia'].value,
        logomarca: document.getElementById('logo-preview').src.startsWith('data:image') ? 
            document.getElementById('logo-preview').src : 
            db.empresa.logomarca || null
    };
    
    db.empresa = { ...db.empresa, ...configData };
    saveData();
    alert('Configurações salvas com sucesso!');
}

function loadConfigData() {
    const form = document.getElementById('form-configuracoes');
    form['config-nome-completo'].value = db.empresa.nomeCompleto || '';
    form['config-cnpj'].value = db.empresa.cnpj || '';
    form['config-razao-social'].value = db.empresa.razaoSocial || '';
    form['config-nome-fantasia'].value = db.empresa.nomeFantasia || '';
    
    const logoPreview = document.getElementById('logo-preview');
    if (db.empresa.logomarca) {
        logoPreview.src = db.empresa.logomarca;
        logoPreview.style.display = 'block';
    } else {
        logoPreview.src = '#';
        logoPreview.style.display = 'none';
    }
}

function previewLogo() {
    const fileInput = document.getElementById('config-logo');
    const logoPreview = document.getElementById('logo-preview');
    const file = fileInput.files[0];
    
    if (file) {
        const reader = new FileReader();
        reader.onload = (e) => {
            logoPreview.src = e.target.result;
            logoPreview.style.display = 'block';
        };
        reader.readAsDataURL(file);
    }
}

function clearAllData(isInitialClear = false) {
    if (isInitialClear || confirm('ATENÇÃO: Tem certeza que deseja limpar TODOS os dados do sistema? Esta ação é irreversível!')) {
        localStorage.removeItem('gestorProDB');
        db = { ...defaultDB };
        renderAllData();
        if (!isInitialClear) alert('Todos os dados foram limpos!');
        showPage('dashboard');
    }
}

// ================================================================================= //
// ========================= NOVAS FUNÇÕES DE RELATÓRIOS =========================== //
// ================================================================================= //

function updateReportFilters() {
    const reportType = document.getElementById('report-type').value;
    const projectFilters = document.getElementById('project-filters');
    const financialFilters = document.getElementById('financial-filters');
    
    if (reportType === 'projetos') {
        projectFilters.style.display = 'block';
        financialFilters.style.display = 'none';
    } else if (reportType === 'financeiro') {
        projectFilters.style.display = 'none';
        financialFilters.style.display = 'block';
    } else {
        projectFilters.style.display = 'none';
        financialFilters.style.display = 'none';
    }
}

function toggleCustomDateRange() {
    const dateRange = document.getElementById('date-range').value;
    const customDateRange = document.getElementById('custom-date-range');
    
    if (dateRange === 'customizado') {
        customDateRange.style.display = 'flex';
        customDateRange.style.flexWrap = 'wrap';
        customDateRange.style.gap = '15px';
        customDateRange.style.alignItems = 'center';
    } else {
        customDateRange.style.display = 'none';
    }
}

function generateReport() {
    const reportType = document.getElementById('report-type').value;
    const dateRange = document.getElementById('date-range').value;
    let startDate, endDate;
    
    // Determinar datas baseado no filtro
    const now = new Date();
    if (dateRange === 'esteMes') {
        startDate = new Date(now.getFullYear(), now.getMonth(), 1);
        endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
    } else if (dateRange === 'ultimos3Meses') {
        startDate = new Date(now.getFullYear(), now.getMonth() - 2, 1);
        endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0);
    } else if (dateRange === 'esteAno') {
        startDate = new Date(now.getFullYear(), 0, 1);
        endDate = new Date(now.getFullYear(), 11, 31);
    } else if (dateRange === 'customizado') {
        const startDateInput = document.getElementById('start-date').value;
        const endDateInput = document.getElementById('end-date').value;
        
        if (!startDateInput || !endDateInput) {
            alert('Por favor, selecione ambas as datas para o período personalizado.');
            return;
        }
        
        startDate = new Date(startDateInput + 'T00:00:00');
        endDate = new Date(endDateInput + 'T23:59:59');
    } else {
        // Todo o período
        startDate = new Date('2000-01-01');
        endDate = new Date('2100-12-31');
    }
    
    // Gerar relatório baseado no tipo
    if (reportType === 'projetos') {
        generateProjectReport(startDate, endDate);
    } else if (reportType === 'financeiro') {
        generateFinancialReport(startDate, endDate);
    } else if (reportType === 'clientes') {
        generateClientReport(startDate, endDate);
    }
    
    // Mostrar resultados e botões de exportação
    document.getElementById('report-results').style.display = 'block';
    document.getElementById('export-pdf-btn').style.display = 'inline-block';
    document.getElementById('export-csv-btn').style.display = 'inline-block';
}

function generateProjectReport(startDate, endDate) {
    const statusFilter = document.getElementById('project-status-filter').value;
    const phaseFilter = document.getElementById('project-phase-filter').value;
    
    // Filtrar projetos
    let filteredProjects = db.projetos.filter(p => {
        const projectDate = p.dataInicio ? new Date(p.dataInicio + 'T00:00:00') : new Date();
        return projectDate >= startDate && projectDate <= endDate;
    });
    
    // Aplicar filtros adicionais
    if (statusFilter !== 'todos') {
        filteredProjects = filteredProjects.filter(p => p.status === statusFilter);
    }
    
    if (phaseFilter !== 'todos') {
        filteredProjects = filteredProjects.filter(p => p.fase === phaseFilter);
    }
    
    // Ordenar por data
    filteredProjects.sort((a, b) => {
        const dateA = a.dataInicio ? new Date(a.dataInicio + 'T00:00:00') : new Date(0);
        const dateB = b.dataInicio ? new Date(b.dataInicio + 'T00:00:00') : new Date(0);
        return dateB - dateA;
    });
    
    // Preparar dados para exibição
    currentReportData = {
        type: 'projetos',
        data: filteredProjects,
        columns: ['Projeto', 'Cliente', 'Valor', 'Status', 'Fase', 'Data Início', 'Progresso']
    };
    
    // Renderizar tabela
    renderReportTable(filteredProjects.map(p => {
        const cliente = db.clientes.find(c => c.id === p.clienteId);
        return [
            p.nome,
            cliente ? cliente.nome : 'N/A',
            formatCurrency(p.valor),
            `<span class="status ${p.status}">${p.status.charAt(0).toUpperCase() + p.status.slice(1)}</span>`,
            p.fase || 'N/A',
            formatDate(p.dataInicio),
            `${p.progresso || 0}%`
        ];
    }));
    
    // Atualizar resumo
    const totalValor = filteredProjects.reduce((sum, p) => sum + (p.valor || 0), 0);
    const avgProgress = filteredProjects.length > 0 ? 
        filteredProjects.reduce((sum, p) => sum + (p.progresso || 0), 0) / filteredProjects.length : 0;
    
    document.getElementById('report-summary').innerHTML = `
        <h4>Resumo do Relatório de Projetos</h4>
        <p><strong>Total de Projetos:</strong> ${filteredProjects.length}</p>
        <p><strong>Valor Total:</strong> ${formatCurrency(totalValor)}</p>
        <p><strong>Progresso Médio:</strong> ${avgProgress.toFixed(1)}%</p>
        <p><strong>Período:</strong> ${startDate.toLocaleDateString('pt-BR')} a ${endDate.toLocaleDateString('pt-BR')}</p>
    `;
}

function generateFinancialReport(startDate, endDate) {
    const periodFilter = document.getElementById('financial-period').value;
    const typeFilter = document.getElementById('financial-type').value;
    
    // Filtrar transações
    let filteredTransactions = db.financeiro.filter(t => {
        const transactionDate = new Date(t.data + 'T00:00:00');
        return transactionDate >= startDate && transactionDate <= endDate;
    });
    
    // Aplicar filtro de tipo
    if (typeFilter !== 'ambos') {
        filteredTransactions = filteredTransactions.filter(t => t.tipo === typeFilter);
    }
    
    // Ordenar por data
    filteredTransactions.sort((a, b) => new Date(b.data + 'T00:00:00') - new Date(a.data + 'T00:00:00'));
    
    // Preparar dados para exibição
    currentReportData = {
        type: 'financeiro',
        data: filteredTransactions,
        columns: ['Descrição', 'Valor', 'Tipo', 'Data', 'Projeto']
    };
    
    // Renderizar tabela
    renderReportTable(filteredTransactions.map(t => {
        const projeto = db.projetos.find(p => p.id === t.projetoId);
        const tipoClass = t.tipo === 'receita' ? 'valor receita' : 'valor despesa';
        const tipoLabel = t.tipo === 'receita' ? 'Receita' : 'Despesa';
        
        return [
            t.descricao,
            `<span class="${tipoClass}">${formatCurrency(t.valor)}</span>`,
            `<span class="status ${t.tipo}">${tipoLabel}</span>`,
            formatDate(t.data),
            projeto ? projeto.nome : 'N/A'
        ];
    }));
    
    // Calcular totais
    const totalReceitas = filteredTransactions
        .filter(t => t.tipo === 'receita')
        .reduce((sum, t) => sum + t.valor, 0);
    
    const totalDespesas = filteredTransactions
        .filter(t => t.tipo === 'despesa')
        .reduce((sum, t) => sum + t.valor, 0);
    
    const saldo = totalReceitas - totalDespesas;
    
    document.getElementById('report-summary').innerHTML = `
        <h4>Resumo do Relatório Financeiro</h4>
        <p><strong>Total de Lançamentos:</strong> ${filteredTransactions.length}</p>
        <p><strong>Total Receitas:</strong> <span style="color: var(--cor-sucesso);">${formatCurrency(totalReceitas)}</span></p>
        <p><strong>Total Despesas:</strong> <span style="color: var(--cor-perigo);">${formatCurrency(totalDespesas)}</span></p>
        <p><strong>Saldo:</strong> <span style="color: ${saldo >= 0 ? 'var(--cor-sucesso)' : 'var(--cor-perigo)'};">${formatCurrency(saldo)}</span></p>
        <p><strong>Período:</strong> ${startDate.toLocaleDateString('pt-BR')} a ${endDate.toLocaleDateString('pt-BR')}</p>
    `;
}

function generateClientReport(startDate, endDate) {
    // Filtrar clientes com projetos no período
    const clientProjects = db.projetos.filter(p => {
        const projectDate = p.dataInicio ? new Date(p.dataInicio + 'T00:00:00') : new Date();
        return projectDate >= startDate && projectDate <= endDate;
    });
    
    // Agrupar por cliente
    const clientMap = new Map();
    
    clientProjects.forEach(p => {
        if (!clientMap.has(p.clienteId)) {
            const cliente = db.clientes.find(c => c.id === p.clienteId);
            if (cliente) {
                clientMap.set(p.clienteId, {
                    cliente: cliente,
                    projetos: [],
                    valorTotal: 0
                });
            }
        }
        
        const clientData = clientMap.get(p.clienteId);
        clientData.projetos.push(p);
        clientData.valorTotal += p.valor || 0;
    });
    
    const clientArray = Array.from(clientMap.values());
    
    // Ordenar por valor total
    clientArray.sort((a, b) => b.valorTotal - a.valorTotal);
    
    // Preparar dados para exibição
    currentReportData = {
        type: 'clientes',
        data: clientArray,
        columns: ['Cliente', 'Email', 'Projetos', 'Valor Total', 'Último Projeto']
    };
    
    // Renderizar tabela
    renderReportTable(clientArray.map(c => {
        const ultimoProjeto = c.projetos.sort((a, b) => {
            const dateA = a.dataInicio ? new Date(a.dataInicio + 'T00:00:00') : new Date(0);
            const dateB = b.dataInicio ? new Date(b.dataInicio + 'T00:00:00') : new Date(0);
            return dateB - dateA;
        })[0];
        
        return [
            c.cliente.nome,
            c.cliente.email,
            c.projetos.length,
            formatCurrency(c.valorTotal),
            ultimoProjeto ? `${ultimoProjeto.nome} (${formatDate(ultimoProjeto.dataInicio)})` : 'N/A'
        ];
    }));
    
    // Atualizar resumo
    const totalClientes = clientArray.length;
    const totalProjetos = clientArray.reduce((sum, c) => sum + c.projetos.length, 0);
    const valorTotal = clientArray.reduce((sum, c) => sum + c.valorTotal, 0);
    
    document.getElementById('report-summary').innerHTML = `
        <h4>Resumo do Relatório de Clientes</h4>
        <p><strong>Total de Clientes:</strong> ${totalClientes}</p>
        <p><strong>Total de Projetos:</strong> ${totalProjetos}</p>
        <p><strong>Valor Total:</strong> ${formatCurrency(valorTotal)}</p>
        <p><strong>Valor Médio por Cliente:</strong> ${formatCurrency(valorTotal / totalClientes)}</p>
        <p><strong>Período:</strong> ${startDate.toLocaleDateString('pt-BR')} a ${endDate.toLocaleDateString('pt-BR')}</p>
    `;
}

function renderReportTable(rows) {
    const tableHead = document.getElementById('report-table-head');
    const tableBody = document.getElementById('report-table-body');
    
    // Limpar tabela
    tableHead.innerHTML = '';
    tableBody.innerHTML = '';
    
    // Adicionar cabeçalho
    if (currentReportData && currentReportData.columns) {
        const headerRow = document.createElement('tr');
        currentReportData.columns.forEach(column => {
            const th = document.createElement('th');
            th.textContent = column;
            headerRow.appendChild(th);
        });
        tableHead.appendChild(headerRow);
    }
    
    // Adicionar linhas
    rows.forEach(rowData => {
        const row = document.createElement('tr');
        rowData.forEach(cellData => {
            const td = document.createElement('td');
            
            // Se for HTML, usar innerHTML, senão textContent
            if (typeof cellData === 'string' && cellData.includes('<')) {
                td.innerHTML = cellData;
            } else {
                td.textContent = cellData;
            }
            
            row.appendChild(td);
        });
        tableBody.appendChild(row);
    });
}

function exportReportToPDF() {
    if (!currentReportData) {
        alert('Nenhum relatório gerado para exportar.');
        return;
    }
    
    // Usar html2canvas para capturar o conteúdo
    const element = document.getElementById('report-results');
    
    html2canvas(element, {
        scale: 2,
        useCORS: true,
        logging: false,
        backgroundColor: '#1a1a2e'
    }).then(canvas => {
        const imgData = canvas.toDataURL('image/png');
        const pdf = new window.jspdf.jsPDF('p', 'mm', 'a4');
        const imgWidth = 190;
        const pageHeight = 280;
        const imgHeight = canvas.height * imgWidth / canvas.width;
        let heightLeft = imgHeight;
        let position = 10;
        
        pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;
        
        while (heightLeft >= 0) {
            position = heightLeft - imgHeight;
            pdf.addPage();
            pdf.addImage(imgData, 'PNG', 10, position, imgWidth, imgHeight);
            heightLeft -= pageHeight;
        }
        
        // Adicionar metadata
        const reportType = document.getElementById('report-type').value;
        const reportTypes = {
            'projetos': 'Relatório de Projetos',
            'financeiro': 'Relatório Financeiro',
            'clientes': 'Relatório de Clientes'
        };
        
        const fileName = `${reportTypes[reportType]}_${new Date().toISOString().split('T')[0]}.pdf`;
        pdf.save(fileName);
    }).catch(error => {
        console.error('Erro ao gerar PDF:', error);
        alert('Erro ao gerar PDF. Tente novamente.');
    });
}

function exportReportToCSV() {
    if (!currentReportData) {
        alert('Nenhum relatório gerado para exportar.');
        return;
    }
    
    const reportType = document.getElementById('report-type').value;
    const reportTypes = {
        'projetos': 'Relatório de Projetos',
        'financeiro': 'Relatório Financeiro',
        'clientes': 'Relatório de Clientes'
    };
    
    let csvContent = '';
    
    // Adicionar cabeçalho
    if (currentReportData.columns) {
        csvContent += currentReportData.columns.join(';') + '\n';
    }
    
    // Adicionar dados
    const tableBody = document.getElementById('report-table-body');
    const rows = tableBody.querySelectorAll('tr');
    
    rows.forEach(row => {
        const cells = row.querySelectorAll('td');
        const rowData = [];
        
        cells.forEach(cell => {
            // Remover HTML e obter texto limpo
            let cellText = cell.textContent.trim();
            
            // Lidar com valores monetários
            if (cellText.includes('R$')) {
                cellText = cellText.replace('R$', '').trim();
            }
            
            // Escapar ponto e vírgula
            cellText = cellText.replace(/;/g, ',');
            
            rowData.push(cellText);
        });
        
        csvContent += rowData.join(';') + '\n';
    });
    
    // Criar blob e baixar
    const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    
    link.href = url;
    link.download = `${reportTypes[reportType]}_${new Date().toISOString().split('T')[0]}.csv`;
    document.body.appendChild(link);
    link.click();
    document.body.removeChild(link);
    URL.revokeObjectURL(url);
}

// Inicializar filtros de relatório
updateReportFilters();
</script>
</body>
</html>
