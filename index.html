
<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GestorPRO - Sistema Futurista</title>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> 
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Lato:wght@400;700&display=swap');
        @import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;700&display=swap'); /* Fonte futurista */

        :root {
            --cor-primaria: #00e676; /* Verde Neon */
            --cor-secundaria: #8c9eff; /* Azul vibrante */
            --cor-sucesso: #00c853; /* Verde mais escuro */
            --cor-perigo: #ff5252; /* Vermelho vibrante */
            --cor-aviso: #ffea00; /* Amarelo vibrante */
            --cor-fundo: #1a1a2e; /* Fundo escuro */
            --cor-fundo-sidebar: #16213e; /* Sidebar um pouco mais escura */
            --cor-texto: #e0e0e0; /* Texto claro */
            --cor-borda: #0f3460; /* Borda escura */
            --sombra-caixa: 0 4px 15px rgba(0, 230, 118, 0.2); /* Sombra neon */
            --card-background: #0f3460; /* Fundo dos cards */
        }

        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Roboto', sans-serif; }
        body { background-color: var(--cor-fundo); color: var(--cor-texto); overflow: hidden; /* Evita scroll desnecess√°rio no body */ }
        .container { display: flex; height: 100vh; }

        /* Sidebar */
        .sidebar { width: 250px; background-color: var(--cor-fundo-sidebar); padding: 20px; border-right: 1px solid var(--cor-borda); display: flex; flex-direction: column; flex-shrink: 0; box-shadow: var(--sombra-caixa); }
        .sidebar-header h3 { font-size: 1.8rem; color: var(--cor-primaria); text-align: center; margin-bottom: 30px; font-family: 'Orbitron', sans-serif; text-shadow: 0 0 10px var(--cor-primaria); }
        .sidebar nav { display: flex; flex-direction: column; gap: 10px; }
        .sidebar nav button {
            background: none; border: none; padding: 12px 15px; border-radius: 8px; text-align: left;
            font-size: 1rem; cursor: pointer; display: flex; align-items: center; gap: 10px;
            transition: background-color 0.3s, color 0.3s, transform 0.2s; color: var(--cor-texto);
        }
        .sidebar nav button:hover { background-color: rgba(0, 230, 118, 0.1); color: var(--cor-primaria); transform: translateX(5px); }
        .sidebar nav button.active { background-color: var(--cor-primaria); color: var(--cor-fundo-sidebar); font-weight: bold; box-shadow: 0 0 15px var(--cor-primaria); }
        .sidebar nav button .ph { font-size: 1.3rem; }

        /* Main Content & Pages */
        .main-content { flex-grow: 1; padding: 30px; overflow-y: auto; scrollbar-width: thin; scrollbar-color: var(--cor-primaria) transparent; }
        .main-content::-webkit-scrollbar { width: 8px; }
        .main-content::-webkit-scrollbar-track { background: transparent; }
        .main-content::-webkit-scrollbar-thumb { background-color: var(--cor-primaria); border-radius: 20px; border: 2px solid var(--cor-fundo); }

        .page { display: none; }
        .page.active { display: block; animation: fadeIn 0.5s forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        h1, h2, h3 { color: var(--cor-primaria); font-family: 'Orbitron', sans-serif; text-shadow: 0 0 8px rgba(0, 230, 118, 0.5); }
        h1 { font-size: 2.2rem; margin-bottom: 25px; display: flex; align-items: center; gap: 15px; }
        h1 .ph { font-size: 2.5rem; }
        h2 { font-size: 1.8rem; margin-top: 35px; margin-bottom: 20px; border-bottom: 2px solid var(--cor-primaria); padding-bottom: 8px; }

        /* Buttons */
        .btn-primary, .btn-secondary, .btn-danger, .btn-warning {
            padding: 12px 25px; border: none; border-radius: 8px; font-size: 1.05rem; cursor: pointer;
            transition: all 0.3s ease; color: var(--cor-fundo); font-weight: bold;
            display: inline-flex; align-items: center; gap: 8px;
        }
        .btn-primary { background-color: var(--cor-primaria); box-shadow: 0 0 10px var(--cor-primaria); }
        .btn-secondary { background-color: var(--cor-secundaria); box-shadow: 0 0 10px var(--cor-secundaria); }
        .btn-danger { background-color: var(--cor-perigo); box-shadow: 0 0 10px var(--cor-perigo); }
        .btn-warning { background-color: var(--cor-aviso); color: var(--cor-fundo); box-shadow: 0 0 10px var(--cor-aviso); }

        .btn-primary:hover { background-color: var(--cor-sucesso); transform: translateY(-3px); box-shadow: 0 5px 15px var(--cor-primaria); }
        .btn-secondary:hover { background-color: #7987ff; transform: translateY(-3px); box-shadow: 0 5px 15px var(--cor-secundaria); }
        .btn-danger:hover { background-color: #e04f4f; transform: translateY(-3px); box-shadow: 0 5px 15px var(--cor-perigo); }
        .btn-warning:hover { background-color: #ffda47; transform: translateY(-3px); box-shadow: 0 5px 15px var(--cor-aviso); }

        /* Cards */
        .dashboard-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px; 
        }
        .financial-summary {
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        .card { background-color: var(--card-background); padding: 25px; border-radius: 12px; box-shadow: var(--sombra-caixa); border: 1px solid var(--cor-borda); }
        .card h3 { margin-bottom: 15px; font-weight: 500; color: var(--cor-texto); display: flex; align-items: center; gap: 8px; }
        /* AJUSTE APLICADO AQUI */
        .card p { font-size: 2.5rem; font-weight: 700; color: var(--cor-primaria); font-family: 'Orbitron', sans-serif; word-break: break-word; }
        .card.receita p { color: var(--cor-sucesso); }
        .card.despesa p { color: var(--cor-perigo); }
        .card.saldo p { color: var(--cor-secundaria); }
        .card.previsao p { color: var(--cor-secundaria); }
        
        .card.planejamento p { color: var(--cor-aviso); }
        .card.andamento p { color: var(--cor-primaria); }
        .card.concluido p { color: var(--cor-sucesso); }
        .card.cancelado p { color: var(--cor-perigo); }


        /* Backup Section (transferido para Configura√ß√µes) */
        .backup-section { background-color: var(--card-background); padding: 25px; border-radius: 12px; box-shadow: var(--sombra-caixa); display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; border: 1px solid var(--cor-borda); margin-bottom: 30px; }
        .backup-section label { color: var(--cor-texto); font-weight: bold; }
        .backup-section input[type="file"] { background-color: var(--cor-fundo); border: 1px solid var(--cor-borda); color: var(--cor-texto); padding: 8px; border-radius: 5px; }


        /* Forms & Tables */
        .form-container, .table-container, .generator-container, .report-container {
            background-color: var(--card-background); padding: 25px; border-radius: 12px; box-shadow: var(--sombra-caixa); margin-bottom: 30px; border: 1px solid var(--cor-borda);
        }
        .form-container h3, .table-container h3, .generator-container h3 { color: var(--cor-primaria); margin-bottom: 20px; font-family: 'Orbitron', sans-serif; }
        .form-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(220px, 1fr)); gap: 20px; align-items: flex-end; }
        input, select, textarea {
            width: 100%; padding: 12px; border: 1px solid var(--cor-borda); border-radius: 8px;
            font-size: 1rem; background-color: #1a1a2e; color: var(--cor-texto);
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        input:focus, select:focus, textarea:focus { border-color: var(--cor-primaria); box-shadow: 0 0 8px rgba(0, 230, 118, 0.5); outline: none; }
        textarea { grid-column: 1 / -1; resize: vertical; min-height: 100px; }
        .form-grid div label { color: var(--cor-texto); font-size: 0.9rem; margin-bottom: 5px; display: block; }

        table { width: 100%; border-collapse: separate; border-spacing: 0; margin-top: 15px; }
        thead { background-color: #1a1a2e; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid var(--cor-borda); color: var(--cor-texto); }
        th { color: var(--cor-primaria); font-weight: bold; text-transform: uppercase; font-size: 0.9rem; }
        tbody tr:nth-child(even) { background-color: rgba(0, 230, 118, 0.03); }
        tbody tr:hover { background-color: rgba(0, 230, 118, 0.1); }

        .actions button { background: none; border: none; cursor: pointer; margin-right: 10px; font-size: 1.3rem; transition: color 0.3s; }
        .actions .edit { color: var(--cor-secundaria); } .actions .delete { color: var(--cor-perigo); }
        .actions .edit:hover { color: #536dfe; } .actions .delete:hover { color: #ff1744; }

        .status { padding: 6px 12px; border-radius: 20px; color: white; font-size: 0.85rem; text-align: center; font-weight: bold; }
        .status.planejamento { background-color: var(--cor-aviso); color: var(--cor-fundo); }
        .status.andamento { background-color: var(--cor-primaria); }
        .status.concluido { background-color: var(--cor-sucesso); }
        .status.cancelado { background-color: var(--cor-perigo); }

        .valor.receita { color: var(--cor-sucesso); font-weight: bold; }
        .valor.despesa { color: var(--cor-perigo); font-weight: bold; }

        /* Document Preview */
        #documento-preview { background: var(--cor-fundo-sidebar); width: 21cm; min-height: 29.7cm; padding: 2cm; margin: 1.5rem auto; box-shadow: var(--sombra-caixa); border: 1px solid var(--cor-borda); font-family: 'Lato', sans-serif; color: var(--cor-texto); }
        #documento-preview .doc-header { text-align: center; margin-bottom: 40px; }
        #documento-preview .doc-header img { max-width: 150px; margin-bottom: 15px; border-radius: 8px; }
        #documento-preview .doc-header h3 { font-size: 2rem; color: var(--cor-primaria); border-bottom: 2px solid var(--cor-primaria); padding-bottom: 10px; }
        #documento-preview .doc-header p { font-size: 1rem; color: var(--cor-texto); margin-top: 5px; }
        #documento-preview .doc-section { margin-bottom: 25px; }
        #documento-preview .doc-section h4 { font-size: 1.1rem; font-weight: bold; margin-bottom: 12px; border-left: 4px solid var(--cor-primaria); padding-left: 10px; color: var(--cor-primaria); }
        #documento-preview p { line-height: 1.8; text-align: justify; margin-bottom: 12px; }
        #documento-preview ol { padding-left: 25px; }
        #documento-preview li { margin-bottom: 10px; }
        #documento-preview .doc-signatures { margin-top: 80px; display: flex; justify-content: space-around; }
        #documento-preview .doc-signature-block { text-align: center; width: 45%; }
        #documento-preview .doc-signature-line { border-bottom: 1px solid var(--cor-primaria); margin-bottom: 8px; }
        #documento-preview .doc-signature-name { font-size: 1rem; color: var(--cor-primaria); font-weight: bold; }
        #documento-preview .doc-receipt-value { background-color: #1a1a2e; border: 1px solid var(--cor-borda); padding: 25px; text-align: center; margin: 35px 0; border-radius: 8px; box-shadow: 0 0 10px rgba(0, 230, 118, 0.3); }
        #documento-preview .doc-receipt-value p { text-align: center; font-size: 1.5rem; font-weight: bold; margin: 0; color: var(--cor-primaria); font-family: 'Orbitron', sans-serif; }

        /* Kanban Board */
        .kanban-board { display: flex; gap: 20px; overflow-x: auto; padding-bottom: 15px; }
        .kanban-column { flex: 1; min-width: 320px; background-color: #16213e; border-radius: 12px; border: 1px solid var(--cor-borda); box-shadow: var(--sombra-caixa); }
        .kanban-column-header { padding: 18px; border-bottom: 2px solid var(--cor-primaria); display: flex; justify-content: space-between; align-items: center; background-color: #0f3460; border-radius: 12px 12px 0 0; }
        .kanban-column-header h4 { margin: 0; font-size: 1.2rem; color: var(--cor-primaria); font-family: 'Orbitron', sans-serif; text-shadow: 0 0 5px rgba(0, 230, 118, 0.5); }
        .kanban-column-header .count { background-color: var(--cor-primaria); color: var(--cor-fundo-sidebar); padding: 4px 10px; border-radius: 15px; font-size: 0.9rem; font-weight: bold; }
        .kanban-column-body { padding: 15px; display: flex; flex-direction: column; gap: 15px; min-height: 200px; }

        .kanban-card {
            background-color: var(--card-background); padding: 18px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            border-left: 5px solid var(--cor-secundaria); transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
            cursor: pointer; /* AJUSTE APLICADO AQUI */
        }
        .kanban-card:hover { transform: translateY(-5px); box-shadow: 0 8px 20px rgba(0, 230, 118, 0.3); }
        .kanban-card h5 { font-size: 1.1rem; margin-bottom: 10px; color: var(--cor-primaria); font-family: 'Orbitron', sans-serif; }
        .kanban-card p { font-size: 0.95rem; color: var(--cor-texto); margin-bottom: 6px; }
        .kanban-card p .ph { vertical-align: middle; margin-right: 8px; color: var(--cor-secundaria); }

        .project-progress-bar-container {
            width: 100%; background-color: #333; border-radius: 5px;
            overflow: hidden; margin-top: 10px; height: 15px;
            border: 1px solid var(--cor-primaria);
        }

        .project-progress-bar {
            height: 100%; background-color: var(--cor-primaria); width: 0%;
            transition: width 0.5s ease-in-out; display: flex; align-items: center;
            justify-content: center; color: var(--cor-fundo); font-size: 0.75rem;
            font-weight: bold; text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
        }

        .project-duration-clock {
            font-family: 'Orbitron', sans-serif; font-size: 0.9rem;
            color: var(--cor-aviso); margin-top: 8px; display: flex;
            align-items: center; gap: 5px;
        }
        .project-duration-clock .ph { font-size: 1rem; color: var(--cor-aviso); }

        /* Relat√≥rios Financeiros */
        .report-filters { display: flex; gap: 20px; margin-bottom: 25px; align-items: center; color: var(--cor-texto); }
        .report-filters label { font-weight: 500; color: var(--cor-primaria); }
        .chart-container { display: grid; grid-template-columns: 1fr 2fr; gap: 30px; align-items: flex-start; }
        .chart-wrapper { background: var(--card-background); padding: 25px; border-radius: 12px; border: 1px solid var(--cor-borda); box-shadow: var(--sombra-caixa); }
        .chart-wrapper h4 { color: var(--cor-primaria); margin-bottom: 15px; font-family: 'Orbitron', sans-serif; }
        .chart { display: flex; justify-content: space-around; align-items: flex-end; height: 250px; border-bottom: 2px solid var(--cor-borda); padding-top: 10px; }
        .chart-bar-group { display: flex; gap: 4px; height: 100%; align-items: flex-end; position: relative; }
        .chart-bar { width: 25px; background-color: var(--cor-sucesso); transition: height 0.5s ease; border-radius: 5px 5px 0 0; }
        .chart-bar.despesa { background-color: var(--cor-perigo); }
        .chart-label { position: absolute; bottom: -30px; width: 100%; text-align: center; font-size: 0.85rem; color: var(--cor-texto); }

        /* Modal de Boas-Vindas */
        .welcome-modal {
            display: none; justify-content: center; align-items: center;
            position: fixed; z-index: 1000; left: 0; top: 0;
            width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px); animation: modalFadeIn 0.5s forwards;
        }

        .welcome-modal-content {
            background-color: var(--card-background); padding: 40px; border-radius: 15px;
            box-shadow: 0 0 30px rgba(0, 230, 118, 0.7); text-align: center;
            max-width: 500px; width: 90%; transform: scale(0.9);
            animation: modalScaleIn 0.5s forwards; border: 2px solid var(--cor-primaria); position: relative;
        }

        .welcome-modal-content h2 {
            color: var(--cor-primaria); font-family: 'Orbitron', sans-serif;
            font-size: 2.5rem; margin-bottom: 20px; text-shadow: 0 0 15px var(--cor-primaria);
        }

        .welcome-modal-content p { font-size: 1.2rem; color: var(--cor-texto); margin-bottom: 30px; line-height: 1.6; }

        .welcome-modal-content button {
            background-color: var(--cor-primaria); color: var(--cor-fundo); padding: 15px 30px;
            border: none; border-radius: 10px; font-size: 1.1rem; font-weight: bold;
            cursor: pointer; transition: background-color 0.3s, transform 0.3s, box-shadow 0.3s;
            box-shadow: 0 0 10px var(--cor-primaria);
        }

        .welcome-modal-content button:hover {
            background-color: var(--cor-sucesso); transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 230, 118, 0.5);
        }

        @keyframes modalFadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes modalScaleIn { from { transform: scale(0.7); opacity: 0; } to { transform: scale(1); opacity: 1; } }

        /* P√°gina de Configura√ß√µes */
        #configuracoes #logo-preview {
            max-width: 200px; max-height: 150px; border: 1px solid var(--cor-borda);
            border-radius: 8px; margin-top: 15px; display: block;
        }
        #configuracoes .logo-upload-container {
            grid-column: 1 / -1; display: flex; flex-direction: column; gap: 10px; align-items: flex-start;
        }
        #configuracoes .logo-upload-container label { margin-bottom: 0; }
        #configuracoes .backup-section { margin-top: 30px; }

        /* Gr√°fico no Dashboard */
        .chart-dashboard-container {
            background-color: var(--card-background); padding: 25px; border-radius: 12px;
            box-shadow: var(--sombra-caixa); margin-top: 30px; border: 1px solid var(--cor-borda);
            width: 100%; max-width: 700px; margin-left: auto; margin-right: auto;
            display: flex; flex-direction: column; align-items: center;
        }
        .chart-dashboard-container h2 {
            margin-top: 0; margin-bottom: 20px; border-bottom: none;
            padding-bottom: 0; text-align: center;
        }
        #projectStatusChart { max-height: 350px; }

        /* MODAIS */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            animation: modalFadeIn 0.5s forwards;
        }

        .modal-content {
            background-color: var(--card-background);
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 30px rgba(0, 230, 118, 0.7);
            width: 90%;
            max-width: 600px;
            border: 2px solid var(--cor-primaria);
            position: relative;
            transform: scale(0.9);
            animation: modalScaleIn 0.5s forwards;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            border-bottom: 1px solid var(--cor-borda);
            padding-bottom: 15px;
        }

        .modal-header h3 {
            margin: 0;
            color: var(--cor-primaria);
            font-family: 'Orbitron', sans-serif;
        }

        .close-modal {
            color: var(--cor-texto);
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.3s;
        }

        .close-modal:hover {
            color: var(--cor-primaria);
        }

        .modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            margin-top: 25px;
        }

        /* Links clic√°veis */
        .project-link {
            color: var(--cor-secundaria);
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
            transition: color 0.3s;
            max-width: 200px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .project-link:hover {
            color: var(--cor-primaria);
            text-decoration: underline;
        }

        .project-link .ph {
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        /* Print Styles */
        @media print {
            body, .container { margin: 0; padding: 0; background-color: white; color: black; }
            .sidebar, .main-content > *:not(#contratos):not(#dashboard), #contratos > *:not(#documento-preview), .document-controls { display: none !important; }
            #dashboard .backup-section { display: none !important; }
            #main-content { padding: 0; overflow: visible; }
            #documento-preview { width: 100%; height: auto; min-height: initial; margin: 0; padding: 1.5cm; box-shadow: none; border: none; color: black; }
            #documento-preview .doc-header h3 { color: black; border-color: #333; }
            #documento-preview .doc-header p, #documento-preview p, #documento-preview li { color: black; }
            #documento-preview .doc-receipt-value { background-color: #f0f0f0; border-color: #ccc; }
            #documento-preview .doc-receipt-value p { color: black; }
            #documento-preview .doc-signature-line { border-color: #333; }
            #documento-preview .doc-signature-name { color: black; }
            #documento-preview .doc-header img { display: block; margin: 0 auto 15px auto; }
        }
    </style>
</head>
<body>
    <div class="container">
        <aside class="sidebar">
            <div class="sidebar-header"><h3>GestorPRO</h3></div>
            <nav>
                <button onclick="showPage('dashboard')"><i class="ph ph-house"></i> Painel de Controle</button>
                <button onclick="showPage('relatorios')"><i class="ph ph-chart-line"></i> Relat√≥rios</button>
                <button onclick="showPage('clientes')"><i class="ph ph-users"></i> Clientes</button>
                <button onclick="showPage('projetos')"><i class="ph ph-kanban"></i> Projetos</button>
                <button onclick="showPage('financeiro')"><i class="ph ph-currency-circle-dollar"></i> Financeiro</button>
                <button onclick="showPage('contratos')"><i class="ph ph-file-text"></i> Contratos e Recibos</button>
                <button onclick="showPage('configuracoes')"><i class="ph ph-gear"></i> Configura√ß√µes</button>
            </nav>
        </aside>

        <main class="main-content">
            <section id="dashboard" class="page">
                <h1><i class="ph ph-house"></i> Painel de Controle</h1>
                <div class="dashboard-grid">
                    <div class="card"><h3 >Clientes Ativos</h3><p id="total-clientes">0</p></div>
                    <div class="card"><h3 >Total de Projetos</h3><p id="total-projetos-geral">0</p></div>
                    <div class="card planejamento"><h3>Planejamento</h3><p id="total-projetos-planejamento">0</p></div>
                    <div class="card andamento"><h3>Em Andamento</h3><p id="total-projetos-andamento-dashboard">0</p></div> 
                    <div class="card concluido"><h3>Conclu√≠dos</h3><p id="total-projetos-concluido">0</p></div>
                    <div class="card cancelado"><h3>Cancelados</h3><p id="total-projetos-cancelado">0</p></div>
                </div>

                <div class="chart-dashboard-container">
                    <h2><i class="ph ph-chart-pie"></i> Status dos Projetos</h2>
                    <canvas id="projectStatusChart"></canvas>
                </div>
            </section>

            <section id="relatorios" class="page">
                <h1><i class="ph ph-chart-line"></i> Relat√≥rio de Projetos por Fase</h1>
                <div class="kanban-board" id="kanban-board"></div>
            </section>

            <section id="clientes" class="page">
                <h1><i class="ph ph-users"></i> Gest√£o de Clientes</h1>
                <button class="btn-primary" onclick="openClientModal()"><i class="ph ph-plus"></i> Adicionar Cliente</button>
                <div class="table-container" style="margin-top: 20px;"><h3>Lista de Clientes</h3><table id="tabela-clientes"><thead><tr><th>Nome</th><th>Email</th><th>Telefone</th><th>A√ß√µes</th></tr></thead><tbody></tbody></table></div>
            </section>
            
            <section id="projetos" class="page">
                <h1><i class="ph ph-kanban"></i> Gest√£o de Projetos</h1>
                <button class="btn-primary" onclick="openProjectModal()"><i class="ph ph-plus"></i> Adicionar Projeto</button>
                <div class="table-container" style="margin-top: 20px;">
                    <h3>Lista de Projetos</h3>
                    <table id="tabela-projetos">
                        <thead>
                            <tr>
                                <th>Projeto</th>
                                <th>Cliente</th>
                                <th>Link</th>
                                <th>Fase Atual</th>
                                <th>Status</th>
                                <th>A√ß√µes</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </section>
            
            <section id="financeiro" class="page">
                <h1><i class="ph ph-currency-circle-dollar"></i> An√°lise Financeira</h1>
                <button class="btn-primary" onclick="openFinancialModal()"><i class="ph ph-plus"></i> Adicionar Lan√ßamento</button>
                <div class="report-container">
                    <div class="report-filters">
                        <label for="financial-period-filter">Exibir per√≠odo:</label>
                        <select id="financial-period-filter" onchange="renderFinancialReport(this.value)">
                            <option value="esteMes">Este M√™s</option><option value="mesPassado">M√™s Passado</option>
                            <option value="esteAno">Este Ano</option><option value="todoPeriodo">Todo o Per√≠odo</option>
                        </select>
                    </div>
                    <div class="financial-summary">
                        <div class="card receita"><h3><i class="ph ph-arrow-circle-up"></i>Receitas</h3><p id="total-receitas">R$ 0,00</p></div>
                        <div class="card despesa"><h3><i class="ph ph-arrow-circle-down"></i>Despesas</h3><p id="total-despesas">R$ 0,00</p></div>
                        <div class="card saldo"><h3><i class="ph ph-scales"></i>Saldo</h3><p id="saldo-total">R$ 0,00</p></div>
                        <div class="card previsao"><h3><i class="ph ph-trend-up"></i> Previs√£o</h3><p id="previsao-receita">R$ 0,00</p></div>
                    </div>
                </div>
                <div class="report-container">
                    <h2>An√°lise Gr√°fica e por Projeto</h2>
                    <div class="chart-container">
                        <div class="table-container" style="margin:0;">
                            <h4>Receitas por Projeto</h4>
                            <table id="tabela-receitas-projeto"><thead><tr><th>Projeto</th><th>Receita Total</th></tr></thead><tbody></tbody></table>
                        </div>
                        <div class="chart-wrapper"><h4>Receitas vs. Despesas Mensais</h4><div class="chart" id="financial-chart"></div></div>
                    </div>
                </div>
                <div class="table-container">
                    <h3>Hist√≥rico Completo de Lan√ßamentos</h3>
                    <table id="tabela-financeiro"><thead><tr><th>Descri√ß√£o</th><th>Valor</th><th>Data</th><th>Projeto</th><th>A√ß√µes</th></tr></thead><tbody></tbody></table>
                </div>
            </section>

            <section id="contratos" class="page">
                <h1><i class="ph ph-file-text"></i> Gerador de Documentos</h1>
                <div class="generator-container">
                    <h3>Configura√ß√£o do Documento</h3>
                    <div class="form-grid">
                        <select id="doc-cliente" onchange="populateProjectDropdown('doc-projeto', this.value)"><option value="">1. Selecione o Cliente</option></select>
                        <select id="doc-projeto"><option value="">2. Selecione o Projeto</option></select>
                    </div>
                    <div class="document-controls" style="margin-top: 20px; display: flex; flex-wrap: wrap; gap: 10px;">
                        <button class="btn-primary" onclick="generateContract()"><i class="ph ph-file-text"></i> Gerar Contrato</button>
                        <button class="btn-secondary" onclick="generateReceipt()"><i class="ph ph-receipt"></i> Gerar Recibo</button>
                        <button id="btn-print" class="btn-warning" style="display: none;" onclick="window.print()"><i class="ph ph-printer"></i> Imprimir / Salvar PDF</button>
                    </div>
                </div>
                <div id="documento-preview"><div style="text-align: center; color: #777; padding-top: 5cm;"><i class="ph ph-file-dashed" style="font-size: 4rem;"></i><p>Selecione um cliente e um projeto para gerar um documento.</p></div></div>
            </section>

            <section id="configuracoes" class="page">
                <h1><i class="ph ph-gear"></i> Configura√ß√µes da Empresa</h1>
                <div class="form-container">
                    <h3>Dados da Empresa</h3>
                    <form id="form-configuracoes" class="form-grid">
                        <div><label for="config-nome-completo">Nome Completo (Respons√°vel)</label><input type="text" id="config-nome-completo" placeholder="Seu Nome Completo"></div>
                        <div><label for="config-cnpj">CNPJ</label><input type="text" id="config-cnpj" placeholder="00.000.000/0000-00"></div>
                        <div><label for="config-razao-social">Raz√£o Social</label><input type="text" id="config-razao-social" placeholder="Raz√£o Social da Sua Empresa"></div>
                        <div><label for="config-nome-fantasia">Nome Fantasia</label><input type="text" id="config-nome-fantasia" placeholder="Nome Fantasia da Sua Empresa"></div>
                        <div class="logo-upload-container">
                            <label for="config-logo">Logomarca (PNG, JPG)</label>
                            <input type="file" id="config-logo" accept="image/png, image/jpeg">
                            <img id="logo-preview" src="#" alt="Pr√©via da Logomarca" style="display: none;">
                        </div>
                        <button type="submit" class="btn-primary">Salvar Configura√ß√µes</button>
                    </form>
                </div>
                
                <h2><i class="ph ph-database"></i> Backup e Restaura√ß√£o</h2>
                <div class="backup-section">
                    <button class="btn-primary" onclick="exportBackup()"><i class="ph ph-download-simple"></i> Exportar Backup</button>
                    <div>
                        <label for="import-file">Importar Backup:</label>
                        <input type="file" id="import-file" accept=".json">
                        <button class="btn-secondary" onclick="importBackup()">Carregar</button>
                    </div>
                </div>
                <button class="btn-danger" style="margin-top: 20px;" onclick="clearAllData()"><i class="ph ph-trash"></i> Limpar Todos os Dados</button>
            </section>
        </main>
    </div>

    <!-- Modal de Boas-Vindas -->
    <div id="welcomeModal" class="welcome-modal">
        <div class="welcome-modal-content">
            <h2>Ol√°, Programador!</h2>
            <p>Seja bem-vindo ao **GestorPRO**!</p>
            <p>Pronto para come√ßar um novo projeto? üöÄ</p>
            <button onclick="closeWelcomeModal()">Vamos l√°!</button>
        </div>
    </div>

    <!-- Modal de Cliente -->
    <div id="clientModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="clientModalTitle">Adicionar Cliente</h3>
                <span class="close-modal" onclick="closeClientModal()">&times;</span>
            </div>
            <form id="form-cliente" class="form-grid">
                <input type="hidden" id="cliente-id">
                <input type="text" id="cliente-nome" placeholder="Nome Completo" required>
                <input type="email" id="cliente-email" placeholder="E-mail" required>
                <input type="tel" id="cliente-telefone" placeholder="Telefone">
                <input type="text" id="cliente-documento" placeholder="CPF/CNPJ">
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeClientModal()">Cancelar</button>
                    <button type="submit" class="btn-primary">Salvar Cliente</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Projeto -->
    <div id="projectModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="projectModalTitle">Adicionar Projeto</h3>
                <span class="close-modal" onclick="closeProjectModal()">&times;</span>
            </div>
            <form id="form-projeto" class="form-grid">
                <input type="hidden" id="projeto-id">
                <input type="text" id="projeto-nome" placeholder="Nome do Projeto" required>
                <select id="projeto-cliente" required><option value="">Selecione um Cliente</option></select>
                <input type="number" id="projeto-valor" placeholder="Valor do Projeto (R$)" step="0.01" required>
                <select id="projeto-status" required>
                    <option value="planejamento">Planejamento</option><option value="andamento">Em Andamento</option>
                    <option value="concluido">Concluido</option><option value="cancelado">Cancelado</option>
                </select>
                <select id="projeto-fase" required>
                    <option value="An√°lise">Fase: An√°lise</option><option value="Design (UI/UX)">Fase: Design (UI/UX)</option>
                    <option value="Desenvolvimento">Fase: Desenvolvimento</option><option value="Testes">Fase: Testes</option>
                    <option value="Implanta√ß√£o">Fase: Implanta√ß√£o</option>
                </select>
                <div><label for="projeto-data-inicio">Data de In√≠cio</label><input type="date" id="projeto-data-inicio"></div>
                <div><label for="projeto-data-fim">Data de Fim</label><input type="date" id="projeto-data-fim"></div>
                
                <div><label for="projeto-duracao-dias">Dura√ß√£o Estimada (Dias)</label><input type="number" id="projeto-duracao-dias" placeholder="Ex: 30" min="1"></div>
                <div><label for="projeto-progresso">Progresso (%)</label><input type="number" id="projeto-progresso" placeholder="0-100" min="0" max="100" value="0"></div>
                
                <!-- NOVO CAMPO: Link do Projeto -->
                <div><label for="projeto-link">Link do Projeto (URL)</label><input type="url" id="projeto-link" placeholder="https://exemplo.com/projeto"></div>

                <textarea id="projeto-descricao" placeholder="Descri√ß√£o do Projeto..." rows="4"></textarea>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeProjectModal()">Cancelar</button>
                    <button type="submit" class="btn-primary">Salvar Projeto</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal de Lan√ßamento Financeiro -->
    <div id="financialModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="financialModalTitle">Adicionar Lan√ßamento</h3>
                <span class="close-modal" onclick="closeFinancialModal()">&times;</span>
            </div>
            <form id="form-financeiro" class="form-grid">
                <input type="hidden" id="lancamento-id">
                <input type="text" id="lancamento-descricao" placeholder="Descri√ß√£o (Ex: Adiantamento)" required>
                <input type="number" id="lancamento-valor" placeholder="Valor (R$)" step="0.01" required>
                <select id="lancamento-tipo" required><option value="receita">Receita</option><option value="despesa">Despesa</option></select>
                <input type="date" id="lancamento-data" required>
                <select id="lancamento-projeto"><option value="">Vincular a um Projeto (Opcional)</option></select>
                <div class="modal-actions">
                    <button type="button" class="btn-secondary" onclick="closeFinancialModal()">Cancelar</button>
                    <button type="submit" class="btn-primary">Adicionar Lan√ßamento</button>
                </div>
            </form>
        </div>
    </div>

<script>
// ================================================================================= //
// =============================== IN√çCIO DO SCRIPT ================================ //
// ================================================================================= //
let projectStatusChartInstance = null;
const defaultDB = { clientes: [], projetos: [], financeiro: [], empresa: {} };
let db = {};

document.addEventListener('DOMContentLoaded', () => {
    initializeApp();
    
    document.getElementById('form-cliente')?.addEventListener('submit', handleClientFormSubmit);
    document.getElementById('form-projeto')?.addEventListener('submit', handleProjectFormSubmit);
    document.getElementById('form-financeiro')?.addEventListener('submit', handleFinancialFormSubmit);
    document.getElementById('form-configuracoes')?.addEventListener('submit', handleConfigFormSubmit);
    document.getElementById('config-logo')?.addEventListener('change', previewLogo);
});


function initializeApp() {
    const dataFromStorage = localStorage.getItem('gestorProDB');
    db = dataFromStorage ? JSON.parse(dataFromStorage) : { ...defaultDB };

    if (!db.empresa) db.empresa = {};

    if (localStorage.getItem('first_run_completed') === null) {
        localStorage.setItem('first_run_completed', 'true');
        clearAllData(true); 
        showWelcomeModal(); 
    } else {
        showPage('dashboard');
        renderAllData();
        loadConfigData();
    }
}

function saveData() {
    localStorage.setItem('gestorProDB', JSON.stringify(db));
    renderAllData();
}

function updateFinancialForecast() {
    const forecastTotal = db.projetos
        .filter(p => p.status === 'planejamento' || p.status === 'andamento')
        .reduce((sum, p) => sum + (p.valor || 0), 0);
    
    document.getElementById('previsao-receita').textContent = formatCurrency(forecastTotal);
}

function renderAllData() {
    renderClientsTable();
    renderProjectsTable();
    renderAllFinancialTransactionsTable();
    renderFinancialReport(document.getElementById('financial-period-filter').value);
    renderPhaseReport();
    updateDashboard();
    updateFinancialForecast();
    renderProjectStatusChart();
    populateClientDropdown('projeto-cliente');
    populateClientDropdown('doc-cliente');
    populateProjectDropdown('lancamento-projeto');
    populateProjectDropdown('doc-projeto', document.getElementById('doc-cliente').value);
    loadConfigData();
}

function showPage(pageId) {
    document.querySelectorAll('.page').forEach(page => page.classList.remove('active'));
    document.getElementById(pageId).classList.add('active');
    document.querySelectorAll('.sidebar nav button').forEach(button => {
        button.classList.remove('active');
        if (button.getAttribute('onclick').includes(pageId)) button.classList.add('active');
    });
    
    if (pageId === 'dashboard') {
        updateDashboard();
        renderProjectStatusChart();
    } else if (pageId === 'financeiro') {
        renderFinancialReport(document.getElementById('financial-period-filter').value);
        updateFinancialForecast();
    } else if (pageId === 'relatorios') {
        renderPhaseReport();
    }
}

const formatCurrency = (value) => (value || 0).toLocaleString('pt-BR', { style: 'currency', currency: 'BRL' });
const formatDate = (dateString) => dateString ? new Date(dateString + 'T00:00:00').toLocaleDateString('pt-BR', {timeZone: 'UTC'}) : 'N/A';
const getNomeCompleto = () => db.empresa.nomeCompleto || "Seu Nome Completo";
const getSeuDocumento = () => db.empresa.cnpj || "00.000.000/0001-00";
const getRazaoSocial = () => db.empresa.razaoSocial || "Sua Raz√£o Social Ltda.";
const getNomeFantasia = () => db.empresa.nomeFantasia || "Seu Nome Fantasia";
const getLogomarca = () => db.empresa.logomarca || null;

function showWelcomeModal() {
    const modal = document.getElementById('welcomeModal');
    if (modal) modal.style.display = 'flex';
}

function closeWelcomeModal() {
    const modal = document.getElementById('welcomeModal');
    if (modal) modal.style.display = 'none';
}

// Fun√ß√µes para abrir e fechar modais
function openClientModal() {
    document.getElementById('clientModal').style.display = 'block';
    document.getElementById('clientModalTitle').textContent = 'Adicionar Cliente';
    document.getElementById('form-cliente').reset();
    document.getElementById('cliente-id').value = '';
}

function closeClientModal() {
    document.getElementById('clientModal').style.display = 'none';
}

function openProjectModal() {
    document.getElementById('projectModal').style.display = 'block';
    document.getElementById('projectModalTitle').textContent = 'Adicionar Projeto';
    document.getElementById('form-projeto').reset();
    document.getElementById('projeto-id').value = '';
    populateClientDropdown('projeto-cliente');
}

function closeProjectModal() {
    document.getElementById('projectModal').style.display = 'none';
}

function openFinancialModal() {
    document.getElementById('financialModal').style.display = 'block';
    document.getElementById('financialModalTitle').textContent = 'Adicionar Lan√ßamento';
    document.getElementById('form-financeiro').reset();
    document.getElementById('lancamento-id').value = '';
    populateProjectDropdown('lancamento-projeto');
}

function closeFinancialModal() {
    document.getElementById('financialModal').style.display = 'none';
}

// Fechar modal ao clicar fora dele
window.onclick = function(event) {
    const clientModal = document.getElementById('clientModal');
    const projectModal = document.getElementById('projectModal');
    const financialModal = document.getElementById('financialModal');
    
    if (event.target === clientModal) {
        closeClientModal();
    }
    if (event.target === projectModal) {
        closeProjectModal();
    }
    if (event.target === financialModal) {
        closeFinancialModal();
    }
}

function renderFinancialReport(period = 'esteMes') {
    const transactions = period === 'todoPeriodo' ? db.financeiro : getTransactionsByPeriod(period);
    const totalReceitas = transactions.filter(t => t.tipo === 'receita').reduce((sum, t) => sum + t.valor, 0);
    const totalDespesas = transactions.filter(t => t.tipo === 'despesa').reduce((sum, t) => sum + t.valor, 0);
    document.getElementById('total-receitas').textContent = formatCurrency(totalReceitas);
    document.getElementById('total-despesas').textContent = formatCurrency(totalDespesas);
    document.getElementById('saldo-total').textContent = formatCurrency(totalReceitas - totalDespesas);
    const receitaPorProjeto = transactions.filter(t => t.tipo === 'receita' && t.projetoId).reduce((acc, t) => { acc[t.projetoId] = (acc[t.projetoId] || 0) + t.valor; return acc; }, {});
    const tabelaReceitasBody = document.querySelector('#tabela-receitas-projeto tbody');
    tabelaReceitasBody.innerHTML = '';
    for (const projetoId in receitaPorProjeto) {
        const projeto = db.projetos.find(p => p.id === projetoId);
        if (projeto) tabelaReceitasBody.insertRow().innerHTML = `<td>${projeto.nome}</td><td>${formatCurrency(receitaPorProjeto[projetoId])}</td>`;
    }
    renderMonthlyChart(transactions);
}

function getTransactionsByPeriod(period) {
    const now = new Date();
    let startDate, endDate;
    if (period === 'esteMes') { startDate = new Date(now.getFullYear(), now.getMonth(), 1); endDate = new Date(now.getFullYear(), now.getMonth() + 1, 0); }
    else if (period === 'mesPassado') { startDate = new Date(now.getFullYear(), now.getMonth() - 1, 1); endDate = new Date(now.getFullYear(), now.getMonth(), 0); }
    else if (period === 'esteAno') { startDate = new Date(now.getFullYear(), 0, 1); endDate = new Date(now.getFullYear(), 11, 31); }
    else { return db.financeiro; }
    return db.financeiro.filter(t => { const transactionDate = new Date(t.data + 'T00:00:00'); return transactionDate >= startDate && transactionDate <= endDate; });
}

function renderMonthlyChart(transactions) {
    const chart = document.getElementById('financial-chart');
    chart.innerHTML = '';
    const dataByMonth = transactions.reduce((acc, t) => { const month = t.data.substring(0, 7); if (!acc[month]) acc[month] = { receita: 0, despesa: 0 }; acc[month][t.tipo] += t.valor; return acc; }, {});
    const sortedMonths = Object.keys(dataByMonth).sort();
    if (sortedMonths.length === 0) { chart.innerHTML = '<p style="font-size:0.9rem; color:#777; text-align:center; width:100%;">Sem dados para exibir no per√≠odo.</p>'; return; }
    const maxVal = Math.max(1, ...Object.values(dataByMonth).flatMap(d => [d.receita, d.despesa]));
    sortedMonths.forEach(month => {
        const { receita, despesa } = dataByMonth[month];
        const monthLabel = new Date(month + '-02').toLocaleDateString('pt-BR', { month: 'short', year: '2-digit' });
        const group = document.createElement('div');
        group.className = 'chart-bar-group';
        group.innerHTML = `<div class="chart-bar receita" style="height: ${(receita/maxVal)*100}%" title="Receita: ${formatCurrency(receita)}"></div><div class="chart-bar despesa" style="height: ${(despesa/maxVal)*100}%" title="Despesa: ${formatCurrency(despesa)}"></div><div class="chart-label">${monthLabel}</div>`;
        chart.appendChild(group);
    });
}

function renderAllFinancialTransactionsTable() {
    const tableBody = document.getElementById('tabela-financeiro').querySelector('tbody');
    tableBody.innerHTML = '';
    db.financeiro.forEach(f => {
        const projeto = db.projetos.find(p => p.id === f.projetoId);
        const row = tableBody.insertRow();
        row.innerHTML = `<td>${f.descricao}</td><td class="valor ${f.tipo}">${formatCurrency(f.valor)}</td><td>${formatDate(f.data)}</td><td>${projeto ? projeto.nome : 'N/A'}</td><td class="actions"><button class="edit" onclick="editFinancial('${f.id}')"><i class="ph ph-pencil-simple"></i></button><button class="delete" onclick="deleteFinancial('${f.id}')"><i class="ph ph-trash"></i></button></td>`;
    });
}

function handleClientFormSubmit(e) {
    e.preventDefault();
    const form = e.target;
    if (!form.checkValidity()) { form.reportValidity(); return; }
    const id = document.getElementById('cliente-id').value;
    const data = { nome: form['cliente-nome'].value, email: form['cliente-email'].value, telefone: form['cliente-telefone'].value, documento: form['cliente-documento'].value }; 
    if (id) { 
        const index = db.clientes.findIndex(c => c.id === id); 
        if (index > -1) db.clientes[index] = { ...db.clientes[index], ...data }; 
    } else { 
        db.clientes.push({ id: 'cli_' + Date.now(), ...data }); 
    } 
    saveData();
    closeClientModal();
}

function renderClientsTable() {
    const tableBody = document.querySelector('#clientes #tabela-clientes tbody');
    tableBody.innerHTML = '';
    db.clientes.forEach(c => {
        const r = tableBody.insertRow();
        r.innerHTML = `<td>${c.nome}</td><td>${c.email}</td><td>${c.telefone}</td><td class="actions"><button class="edit" onclick="editClient('${c.id}')"><i class="ph ph-pencil-simple"></i></button><button class="delete" onclick="deleteClient('${c.id}')"><i class="ph ph-trash"></i></button></td>`;
    });
}

function editClient(id) { 
    const c = db.clientes.find(c => c.id === id);
    if (!c) return;
    const form = document.getElementById('form-cliente');
    form['cliente-id'].value = c.id; 
    form['cliente-nome'].value = c.nome; 
    form['cliente-email'].value = c.email; 
    form['cliente-telefone'].value = c.telefone; 
    form['cliente-documento'].value = c.documento; 
    document.getElementById('clientModalTitle').textContent = 'Editar Cliente';
    document.getElementById('clientModal').style.display = 'block';
    showPage('clientes'); 
    window.scrollTo(0,0); 
}

function deleteClient(id) { if (confirm('Tem certeza? Excluir um cliente tamb√©m excluir√° seus projetos e lan√ßamentos financeiros!')) { const projetosDoCliente = db.projetos.filter(p => p.clienteId === id).map(p => p.id); db.clientes = db.clientes.filter(c => c.id !== id); db.projetos = db.projetos.filter(p => p.clienteId !== id); db.financeiro = db.financeiro.filter(f => !projetosDoCliente.includes(f.projetoId)); saveData(); } }

function handleProjectFormSubmit(e) {
    e.preventDefault();
    const form = e.target;
    if (!form.checkValidity()) { form.reportValidity(); return; }
    const id = form['projeto-id'].value;
    const data = {
        nome: form['projeto-nome'].value, clienteId: form['projeto-cliente'].value,
        valor: parseFloat(form['projeto-valor'].value), status: form['projeto-status'].value,
        fase: form['projeto-fase'].value, dataInicio: form['projeto-data-inicio'].value,
        dataFim: form['projeto-data-fim'].value, descricao: form['projeto-descricao'].value,
        duracaoDias: parseInt(form['projeto-duracao-dias'].value) || 0, progresso: parseInt(form['projeto-progresso'].value) || 0,
        link: form['projeto-link'].value // NOVO CAMPO: Link do projeto
    };
    if (id) {
        const index = db.projetos.findIndex(p => p.id === id);
        if (index > -1) db.projetos[index] = { ...db.projetos[index], ...data };
    } else {
        db.projetos.push({ id: 'proj_' + Date.now(), ...data });
    }
    saveData();
    closeProjectModal();
}

function editProject(id) {
    const p = db.projetos.find(p => p.id === id);
    if (!p) return;
    const form = document.getElementById('form-projeto');
    form['projeto-id'].value = p.id;
    form['projeto-nome'].value = p.nome;
    form['projeto-cliente'].value = p.clienteId;
    form['projeto-valor'].value = p.valor;
    form['projeto-status'].value = p.status;
    form['projeto-fase'].value = p.fase || 'An√°lise';
    form['projeto-data-inicio'].value = p.dataInicio;
    form['projeto-data-fim'].value = p.dataFim;
    form['projeto-descricao'].value = p.descricao;
    form['projeto-duracao-dias'].value = p.duracaoDias || '';
    form['projeto-progresso'].value = p.progresso || 0;
    form['projeto-link'].value = p.link || ''; // NOVO CAMPO: Link do projeto
    document.getElementById('projectModalTitle').textContent = 'Editar Projeto';
    document.getElementById('projectModal').style.display = 'block';
    showPage('projetos');
    window.scrollTo(0, 0);
}

function deleteProject(id) { if (confirm('Tem certeza?')) { db.projetos = db.projetos.filter(p => p.id !== id); db.financeiro = db.financeiro.filter(f => f.projetoId !== id); saveData(); } }

function renderProjectsTable() { 
    const tableBody = document.querySelector('#projetos #tabela-projetos tbody'); 
    tableBody.innerHTML = ''; 
    db.projetos.forEach(p => { 
        const cliente = db.clientes.find(c => c.id === p.clienteId); 
        const r = tableBody.insertRow(); 
        
        // Link do projeto clic√°vel
        let linkHtml = 'N/A';
        if (p.link) {
            // Extrair o dom√≠nio para exibi√ß√£o mais limpa
            const domain = p.link.replace(/^https?:\/\/(www\.)?/, '').split('/')[0];
            linkHtml = `<a href="${p.link}" target="_blank" class="project-link" title="${p.link}"><i class="ph ph-link"></i> ${domain}</a>`;
        }
        
        r.innerHTML = `
            <td>${p.nome}</td>
            <td>${cliente ? cliente.nome : 'N/A'}</td>
            <td>${linkHtml}</td>
            <td>${p.fase || 'N/A'}</td>
            <td><span class="status ${p.status}">${p.status.charAt(0).toUpperCase() + p.status.slice(1)}</span></td>
            <td class="actions">
                <button class="edit" onclick="editProject('${p.id}')"><i class="ph ph-pencil-simple"></i></button>
                <button class="delete" onclick="deleteProject('${p.id}')"><i class="ph ph-trash"></i></button>
            </td>
        `; 
    }); 
}

function handleFinancialFormSubmit(e) {
    e.preventDefault();
    const form = e.target;
    if (!form.checkValidity()) { form.reportValidity(); return; }
    const id = form['lancamento-id'].value; 
    const data = { 
        descricao: form['lancamento-descricao'].value, valor: parseFloat(form['lancamento-valor'].value), 
        tipo: form['lancamento-tipo'].value, data: form['lancamento-data'].value, projetoId: form['lancamento-projeto'].value 
    }; 
    if (id) { 
        const index = db.financeiro.findIndex(f => f.id === id); 
        if (index > -1) db.financeiro[index] = { ...db.financeiro[index], ...data }; 
    } else { 
        db.financeiro.push({ id: 'fin_' + Date.now(), ...data }); 
    } 
    saveData();
    closeFinancialModal();
}

function editFinancial(id) { 
    const f = db.financeiro.find(f => f.id === id);
    if (!f) return;
    const form = document.getElementById('form-financeiro');
    form['lancamento-id'].value = f.id; 
    form['lancamento-descricao'].value = f.descricao; 
    form['lancamento-valor'].value = f.valor; 
    form['lancamento-tipo'].value = f.tipo; 
    form['lancamento-data'].value = f.data; 
    form['lancamento-projeto'].value = f.projetoId; 
    document.getElementById('financialModalTitle').textContent = 'Editar Lan√ßamento';
    document.getElementById('financialModal').style.display = 'block';
    showPage('financeiro'); window.scrollTo(0,0); 
}

function deleteFinancial(id) { if (confirm('Tem certeza?')) { db.financeiro = db.financeiro.filter(f => f.id !== id); saveData(); } }
function populateClientDropdown(elementId) { const select = document.getElementById(elementId); const val = select.value; select.innerHTML = `<option value="">Selecione um Cliente</option>`; db.clientes.forEach(c => select.add(new Option(c.nome, c.id))); select.value = val; }
function populateProjectDropdown(elementId, filterByClientId = null) { const select = document.getElementById(elementId); const val = select.value; select.innerHTML = `<option value="">Selecione um Projeto</option>`; let projetos = filterByClientId ? db.projetos.filter(p => p.clienteId === filterByClientId) : db.projetos; projetos.forEach(p => select.add(new Option(p.nome, p.id))); select.value = val; }

function updateDashboard() {
    document.getElementById('total-clientes').textContent = db.clientes.length;
    document.getElementById('total-projetos-geral').textContent = db.projetos.length;
    document.getElementById('total-projetos-planejamento').textContent = db.projetos.filter(p => p.status === 'planejamento').length;
    document.getElementById('total-projetos-andamento-dashboard').textContent = db.projetos.filter(p => p.status === 'andamento').length;
    document.getElementById('total-projetos-concluido').textContent = db.projetos.filter(p => p.status === 'concluido').length;
    document.getElementById('total-projetos-cancelado').textContent = db.projetos.filter(p => p.status === 'cancelado').length;
}

function renderPhaseReport() {
    const kanbanBoard = document.getElementById('kanban-board');
    if(!kanbanBoard) return;
    kanbanBoard.innerHTML = '';
    const fases = ['An√°lise', 'Design (UI/UX)', 'Desenvolvimento', 'Testes', 'Implanta√ß√£o'];
    fases.forEach(fase => {
        const projetosNestaFase = db.projetos.filter(p => p.fase === fase && p.status !== 'concluido' && p.status !== 'cancelado');
        const column = document.createElement('div');
        column.className = 'kanban-column';
        let cardsHtml = '';
        if (projetosNestaFase.length > 0) {
            projetosNestaFase.forEach(p => {
                const c = db.clientes.find(c => c.id === p.clienteId);
                const duracaoHtml = p.duracaoDias ? `<p class="project-duration-clock"><i class="ph ph-hourglass"></i> ${p.duracaoDias} dias</p>` : '';
                const progressoHtml = `<div class="project-progress-bar-container"><div class="project-progress-bar" style="width: ${p.progresso || 0}%">${p.progresso || 0}%</div></div>`;
                // AJUSTE APLICADO AQUI para adicionar o onclick
                cardsHtml += `
                    <div class="kanban-card" onclick="editProject('${p.id}')">
                        <h5>${p.nome}</h5>
                        <p><i class="ph ph-user"></i> ${c ? c.nome : 'N/A'}</p>
                        <p><i class="ph ph-currency-circle-dollar"></i> ${formatCurrency(p.valor)}</p>
                        ${duracaoHtml}
                        ${progressoHtml}
                    </div>`;
            });
        } else {
            cardsHtml = '<p style="font-size: 0.8rem; color: #777; text-align: center; padding: 15px;">Nenhum projeto aqui.</p>';
        }
        column.innerHTML = `
            <div class="kanban-column-header"><h4>${fase}</h4><span class="count">${projetosNestaFase.length}</span></div>
            <div class="kanban-column-body">${cardsHtml}</div>`;
        kanbanBoard.appendChild(column);
    });
}

function renderProjectStatusChart() {
    const ctx = document.getElementById('projectStatusChart');
    if (projectStatusChartInstance) projectStatusChartInstance.destroy();
    const statusCounts = db.projetos.reduce((acc, p) => { acc[p.status] = (acc[p.status] || 0) + 1; return acc; }, {});
    projectStatusChartInstance = new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Planejamento', 'Em Andamento', 'Conclu√≠do', 'Cancelado'],
            datasets: [{
                data: [statusCounts.planejamento || 0, statusCounts.andamento || 0, statusCounts.concluido || 0, statusCounts.cancelado || 0],
                backgroundColor: ['rgba(255, 234, 0, 0.7)', 'rgba(0, 230, 118, 0.7)', 'rgba(0, 200, 83, 0.7)', 'rgba(255, 82, 82, 0.7)'],
                borderColor: ['rgb(255, 234, 0)', 'rgb(0, 230, 118)', 'rgb(0, 200, 83)', 'rgb(255, 82, 82)'],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true, maintainAspectRatio: false,
            plugins: {
                legend: { position: 'top', labels: { color: 'var(--cor-texto)', font: { size: 14 } } },
                tooltip: { callbacks: { label: (c) => `${c.label || ''}: ${c.parsed || 0} projetos` } }
            }
        }
    });
}

function generateContract() {
    const cId = document.getElementById('doc-cliente').value;
    const pId = document.getElementById('doc-projeto').value;
    if (!cId || !pId) return alert('Selecione cliente e projeto.');
    const c = db.clientes.find(c => c.id === cId);
    const p = db.projetos.find(p => p.id === pId);
    const logoHtml = getLogomarca() ? `<img src="${getLogomarca()}" alt="Logomarca da Empresa">` : '';
    document.getElementById('documento-preview').innerHTML = `<div class="doc-header">${logoHtml}<h3>CONTRATO DE PRESTA√á√ÉO DE SERVI√áOS</h3><p>${getRazaoSocial()} (${getNomeFantasia()}) - CNPJ: ${getSeuDocumento()}</p></div><div class="doc-section"><h4>PARTES CONTRATANTES</h4><p><strong>CONTRATANTE:</strong> ${c.nome.toUpperCase()}, CPF/CNPJ: ${c.documento || '[n√£o informado]'}.</p><p><strong>CONTRATADO(A):</strong> ${getNomeCompleto().toUpperCase()}, CPF/CNPJ: ${getSeuDocumento()}.</p></div><div class="doc-section"><h4>CL√ÅUSULAS E CONDI√á√ïES</h4><ol><li><strong>DO OBJETO:</strong> Presta√ß√£o de servi√ßos de desenvolvimento para o projeto <strong>"${p.nome}"</strong>. Escopo: ${p.descricao || 'Conforme proposta.'}</li><li><strong>DO VALOR:</strong> O valor total √© de <strong>${formatCurrency(p.valor)}</strong>.</li><li><strong>DO PRAZO:</strong> De ${formatDate(p.dataInicio)} a ${formatDate(p.dataFim)}.</li><li><strong>DO FORO:</strong> Fica eleito o foro da comarca de Macei√≥/AL.</li></ol></div><p>E, por estarem justos e contratados, assinam o presente.</p><div class="doc-signatures"><div class="doc-signature-block"><div class="doc-signature-line"></div><div class="doc-signature-name">${getNomeCompleto()}</div><div class="doc-signature-name">CONTRATADO(A)</div></div><div class="doc-signature-block"><div class="doc-signature-line"></div><div class="doc-signature-name">${c.nome}</div><div class="doc-signature-name">CONTRATANTE</div></div></div>`;
    document.getElementById('btn-print').style.display = 'inline-block';
}

function generateReceipt() {
    const cId = document.getElementById('doc-cliente').value;
    const pId = document.getElementById('doc-projeto').value;
    if (!cId || !pId) return alert('Selecione cliente e projeto.');
    const c = db.clientes.find(c => c.id === cId);
    const p = db.projetos.find(p => p.id === pId);
    const logoHtml = getLogomarca() ? `<img src="${getLogomarca()}" alt="Logomarca da Empresa">` : '';
    document.getElementById('documento-preview').innerHTML = `<div class="doc-header">${logoHtml}<h3>RECIBO DE PAGAMENTO</h3><p>Recibo N¬∫: REC-${Date.now().toString().slice(-6)}</p><p>${getRazaoSocial()} (${getNomeFantasia()}) - CNPJ: ${getSeuDocumento()}</p></div><div class="doc-section"><h4>DADOS DO PAGAMENTO</h4><p>Recebemos de <strong>${c.nome.toUpperCase()}</strong> (CPF/CNPJ: ${c.documento || '[n√£o informado]'}) a import√¢ncia descrita abaixo.</p></div><div class="doc-receipt-value"><p>${formatCurrency(p.valor)}</p></div><p>Valor referente ao projeto <strong>"${p.nome}"</strong>.</p><p>Para clareza, firmamos o presente.</p><div class="doc-signatures" style="margin-top: 120px;"><div class="doc-signature-block"><div class="doc-signature-line"></div><div class="doc-signature-name">${getNomeCompleto()}</div><div class="doc-signature-name">Emitente</div></div></div><div style="text-align: center; margin-top: 40px;"><p>Macei√≥, ${new Date().toLocaleDateString('pt-BR', { day: '2-digit', month: 'long', year: 'numeric' })}.</p></div>`;
    document.getElementById('btn-print').style.display = 'inline-block';
}

function exportBackup() { const dataStr = JSON.stringify(db, null, 2); const dataBlob = new Blob([dataStr], { type: 'application/json' }); const url = URL.createObjectURL(dataBlob); const link = document.createElement('a'); link.href = url; link.download = `backup-gestorpro-${new Date().toISOString().split('T')[0]}.json`; document.body.appendChild(link); link.click(); document.body.removeChild(link); URL.revokeObjectURL(url); }
function importBackup() { const fileInput = document.getElementById('import-file'); const file = fileInput.files[0]; if (!file) return alert('Selecione um arquivo.'); const reader = new FileReader(); reader.onload = (e) => { try { const data = JSON.parse(e.target.result); if (confirm('Isso substituir√° todos os dados. Continuar?')) { db = { ...defaultDB, ...data }; saveData(); alert('Backup importado!'); } } catch (err) { alert('Erro no arquivo.'); } finally { fileInput.value = ''; } }; reader.readAsText(file); }

function handleConfigFormSubmit(e) {
    e.preventDefault();
    const form = e.target;
    if (!form.checkValidity()) { form.reportValidity(); return; }
    const configData = {
        nomeCompleto: form['config-nome-completo'].value, cnpj: form['config-cnpj'].value,
        razaoSocial: form['config-razao-social'].value, nomeFantasia: form['config-nome-fantasia'].value,
        logomarca: document.getElementById('logo-preview').src.startsWith('data:image') ? document.getElementById('logo-preview').src : db.empresa.logomarca || null
    };
    db.empresa = { ...db.empresa, ...configData };
    saveData();
    alert('Configura√ß√µes salvas com sucesso!');
}

function loadConfigData() {
    const form = document.getElementById('form-configuracoes');
    form['config-nome-completo'].value = db.empresa.nomeCompleto || '';
    form['config-cnpj'].value = db.empresa.cnpj || '';
    form['config-razao-social'].value = db.empresa.razaoSocial || '';
    form['config-nome-fantasia'].value = db.empresa.nomeFantasia || '';
    const logoPreview = document.getElementById('logo-preview');
    if (db.empresa.logomarca) {
        logoPreview.src = db.empresa.logomarca;
        logoPreview.style.display = 'block';
    } else {
        logoPreview.src = '#';
        logoPreview.style.display = 'none';
    }
}

function previewLogo() {
    const fileInput = document.getElementById('config-logo');
    const logoPreview = document.getElementById('logo-preview');
    const file = fileInput.files[0];
    if (file) {
        const reader = new FileReader();
        reader.onload = (e) => { logoPreview.src = e.target.result; logoPreview.style.display = 'block'; };
        reader.readAsDataURL(file);
    }
}

function clearAllData(isInitialClear = false) {
    if (isInitialClear || confirm('ATEN√á√ÉO: Tem certeza que deseja limpar TODOS os dados do sistema? Esta a√ß√£o √© irrevers√≠vel!')) {
        localStorage.removeItem('gestorProDB');
        db = { ...defaultDB };
        renderAllData(); 
        if (!isInitialClear) alert('Todos os dados foram limpos!');
        showPage('dashboard');
    }
}
</script>
</body>
</html>
